{"id":"AssurancePlatform-0m0","title":"Support multiple Evidence URLs per element","description":"Allow users to add multiple URLs to evidence elements instead of just one.\n\nGitHub Issue: #427\n\nUser Story:\nAs an AI practitioner, I want to upload \u003e1 pieces of evidence (e.g., URLs) to particular evidence elements so that I can keep track of more complex pieces of evidence.\n\nRequirements:\n- Add multiple URLs to an evidence element\n- View all URLs associated with an evidence element\n- Remove individual URLs without affecting others\n- Input validation for URL format\n- XSS protection for stored/displayed URLs\n\nTechnical Notes:\n- Database schema change: array of URLs or related table\n- Dynamic form component for adding URL fields\n- API modifications for CRUD on multiple URLs\n\nAcceptance Criteria:\n- [ ] Users can add multiple URLs to evidence elements\n- [ ] All URLs are visible and accessible when viewing element\n- [ ] Individual URLs can be removed\n- [ ] URLs are validated before submission\n- [ ] Accessible UI for managing URLs","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-07T13:43:26.829014Z","created_by":"cburr","updated_at":"2026-01-07T13:43:26.829014Z","labels":["data-model","feature"]}
{"id":"AssurancePlatform-27s","title":"Phase 2b': Curriculum Module System","description":"Develop modular, reusable components for TEA curriculum modules.\n\nTasks:\n- [x] Case Viewer redesign with ELK layout engine\n- [x] Progress Tracker MVP with manual checkpoints\n\nKey Decisions:\n- JSON Format: Prisma-aligned flat format\n- Layout Engine: ELK only (replacing Dagre)\n- Progress Storage: localStorage for anonymous, DB for authenticated (DB deferred)\n- Node Components: Unified AssuranceNode with configuration-driven styling\n\nDeferred:\n- Database persistence for authenticated users\n- Sync queue for offline support\n- Full learning record storage","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-07T12:58:04.248635Z","created_by":"cburr","updated_at":"2026-01-07T13:00:18.660556Z","labels":["documentation"],"deleted_at":"2026-01-07T13:00:18.660556Z","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"AssurancePlatform-59h","title":"My first issue","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-24T10:21:42.184897Z","updated_at":"2025-12-24T10:23:10.736974Z","closed_at":"2025-12-24T10:23:10.736974Z","close_reason":"Just testing"}
{"id":"AssurancePlatform-5fm","title":"Phase 2d: Auth Cleanup (RefreshToken Removal)","description":"Final cleanup of the legacy RefreshToken authentication system. BLOCKED until 2025-01-19 (30 days after JWT-only deployment).\n\nPre-requisite: JWT-only auth (USE_JWT_ONLY_AUTH=true) must be stable in production for 30+ days.\n\nCode Cleanup:\n- [ ] Delete lib/auth/refresh-token-service.ts\n- [ ] Delete lib/auth/validate-session.ts\n- [ ] Delete lib/auth/feature-flags.ts\n- [ ] Update lib/auth-options.ts - Remove legacy RefreshToken code\n- [ ] Update middleware.ts - Remove stale session detection\n- [ ] Update types/next-auth.d.ts - Remove key from Session type\n- [ ] Remove USE_JWT_ONLY_AUTH from environment variables\n\nClient Component Cleanup (remove session?.key references):\n- [ ] components/common/node-edit.tsx\n- [ ] components/common/new-link-form.tsx\n- [ ] components/common/edit-form.tsx\n- [ ] components/common/create-form.tsx\n- [ ] components/cases/orphan-elements.tsx\n\nTest Updates:\n- [ ] app/(landing)/_components/__tests__/header.test.tsx\n- [ ] lib/__tests__/auth-helpers.test.ts\n\nDatabase Migration:\n- [ ] Create Prisma migration to drop RefreshToken table\n- [ ] Run on staging first\n- [ ] Run on production","status":"blocked","priority":2,"issue_type":"task","created_at":"2026-01-07T12:58:17.791742Z","created_by":"cburr","updated_at":"2026-01-07T13:00:49.171353Z","labels":["auth","tech-debt"]}
{"id":"AssurancePlatform-5o1","title":"Code Quality: Replace raw SQL pattern in health check","description":"The health check in app/api/health/route.ts (line 34) uses $queryRaw with a hardcoded query.\n\n**Current code:**\n```typescript\nawait prisma.$queryRaw`SELECT 1`;\n```\n\n**Issue:** While this specific usage is safe (hardcoded query with no user input), using $queryRaw sets a pattern that could be dangerous if copied elsewhere.\n\n**Fix:** Replace with a safer alternative:\n```typescript\nawait prisma.user.count({ take: 1 }); // Prisma ORM method\n```\n\n**Confidence:** 80%","status":"closed","priority":2,"issue_type":"chore","created_at":"2025-12-24T10:27:30.403578Z","updated_at":"2026-01-02T10:57:51.766249Z","closed_at":"2026-01-02T10:57:51.766249Z","close_reason":"Replaced $queryRaw with prisma.user.count({ take: 1 }) and added unit tests","labels":["code-quality"]}
{"id":"AssurancePlatform-7ce","title":"Security: Fix misleading sanitizeDescription function (XSS risk)","description":"The sanitizeDescription function in lib/sanitize-html.ts (lines 5-8) only removes a single pattern (\u003cp\u003e\u003cbr\u003e\u003c/p\u003e) and doesn't actually sanitize HTML.\n\n**Issue:** The function is named 'sanitize' but provides no actual sanitization, leaving XSS vulnerabilities if used with that expectation.\n\n**Example attack:**\n```javascript\nconst malicious = '\u003cimg src=x onerror=\"alert(document.cookie)\"\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e';\nsanitizeDescription(malicious); \n// Returns: '\u003cimg src=x onerror=\"alert(document.cookie)\"\u003e'\n// XSS still present!\n```\n\n**Fix:** Either use a proper HTML sanitization library (DOMPurify or sanitize-html) or rename to removeEmptyParagraphs() to avoid confusion.\n\n**Confidence:** 95%","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-24T10:27:15.692483Z","updated_at":"2026-01-02T12:07:06.402194Z","closed_at":"2026-01-02T12:07:06.402194Z","close_reason":"Added DOMPurify sanitisation to strip XSS vectors","labels":["security","xss"]}
{"id":"AssurancePlatform-at5","title":"Plan migration to rename legacy table names (api_*)","description":"Legacy table names from Django migration remain in the Prisma schema (e.g., api_casestudy, legacy_mappings).\n\nPlan and execute a migration to use cleaner table names.\n\nConsiderations:\n- Foreign key dependencies\n- Downtime requirements\n- Rollback strategy\n\nDeferred from Phase 2c.","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-07T13:00:38.167572Z","created_by":"cburr","updated_at":"2026-01-07T13:00:38.167572Z","labels":["tech-debt"]}
{"id":"AssurancePlatform-bdi","title":"Implement Published Cases feature","description":"The Published Cases functionality currently returns empty arrays marked 'Not yet implemented'.\n\nLocation: Various files returning published cases data\n\nThis feature should allow users to publish their assurance cases for public viewing.\n\nDeferred from Phase 2c.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-07T13:00:37.881351Z","created_by":"cburr","updated_at":"2026-01-07T13:00:37.881351Z","labels":["feature"]}
{"id":"AssurancePlatform-bp8","title":"Audit environment variables on Azure app services","description":"Audit all environment variables on both production and staging Azure App Services.\n\nGoals:\n- Document all required env vars\n- Remove obsolete variables\n- Ensure consistency between environments\n- Update .env.example\n\nDeferred from Phase 2c.","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-07T13:00:38.796593Z","created_by":"cburr","updated_at":"2026-01-07T13:00:38.796593Z","labels":["devops"]}
{"id":"AssurancePlatform-c0l","title":"Phase 2c: Technical Cleanup","description":"Housekeeping tasks to consolidate dependencies, remove legacy code, and address technical debt.\n\nCompleted Tasks:\n- [x] Consolidate notifications: Remove react-toastify in favour of sonner\n- [x] Replace moment.js with date-fns\n- [x] Centralise public route definitions (lib/routes.ts)\n- [x] Delete eap-backend App Service (old Django backend)\n- [x] Delete frontend-test-resource (unused Azure Load Testing)\n- [x] Implement JWT-only auth with USE_JWT_ONLY_AUTH feature flag\n\nDeferred Tasks:\n- [ ] Implement Published Cases (returns empty arrays)\n- [ ] Plan migration to rename legacy table names (api_*)\n- [ ] Ensure all Server Actions use Zod validation\n- [ ] Audit all env vars on both app services\n- [ ] Rename staging database from postgres to eap\n\nLint Exclusions to Address:\n- components/ui/** (shadcn/ui patterns)\n- types/*.d.ts\n- app/api/cases/*/permissions/**\n- Various files with suppression comments","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-07T12:58:17.49846Z","created_by":"cburr","updated_at":"2026-01-07T13:00:21.430949Z","labels":["tech-debt"],"deleted_at":"2026-01-07T13:00:21.430949Z","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"AssurancePlatform-ceo","title":"Security: Address timing attack vulnerability in JWT callback","description":"The JWT callback in lib/auth-options.ts (lines 302-305) checks token expiry and clears expired tokens in a way that creates timing side-channel.\n\n**Issue:** Valid tokens complete the full callback execution path while expired tokens modify the token object then return. This creates measurable timing differences that could be exploited for session enumeration.\n\n**Impact:** An attacker could use timing attacks to determine if a session token has expired without having valid credentials.\n\n**Fix:** Move the expiry validation to a separate middleware or route guard with constant-time checks.\n\n**Confidence:** 85%","status":"open","priority":1,"issue_type":"bug","created_at":"2025-12-24T10:27:23.037717Z","updated_at":"2025-12-24T10:27:23.037717Z","labels":["auth","security"]}
{"id":"AssurancePlatform-cep","title":"Rename staging database from 'postgres' to 'eap'","description":"The staging database is named 'postgres' while production uses 'eap'. Rename for consistency.\n\nCurrent:\n- Production: eap-database-v15 / eap\n- Staging: staging-eap-database / postgres\n\nTarget:\n- Staging: staging-eap-database / eap\n\nDeferred from Phase 2c.","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-07T13:00:39.111345Z","created_by":"cburr","updated_at":"2026-01-07T13:00:39.111345Z","labels":["devops"]}
{"id":"AssurancePlatform-cta","title":"Ensure all Server Actions use Zod validation","description":"Audit all Server Actions in actions/ directory and ensure they use Zod schemas for input validation.\n\nThis improves type safety and provides better error messages for invalid input.\n\nDeferred from Phase 2c.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-07T13:00:38.478085Z","created_by":"cburr","updated_at":"2026-01-07T13:00:38.478085Z","labels":["code-quality"]}
{"id":"AssurancePlatform-d8t","title":"Close 22 GitHub issues covered by TASKS directory","description":"Close the 22 GitHub issues that are already tracked in the TASKS directory phases.\n\n## Reference\nSee TASKS/GitHub-Issues-Migration.md for:\n- Full list of issues to close (22 total)\n- Suggested close messages for each issue\n- CLI commands for bulk closing\n\n## Issues to Close\n### Originally Covered (15)\n#713, #654, #488, #687, #498, #490, #465, #464, #463, #426, #425, #645, #460, #458, #432\n\n### Previously Partially Covered (7)\n#665, #492, #686, #684, #689, #485, #652","acceptance_criteria":"- [ ] All 22 issues closed with appropriate comments\n- [ ] Each close message references the relevant TASKS phase","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-02T17:09:15.01986Z","created_by":"cburr","updated_at":"2026-01-07T13:45:10.480636Z","closed_at":"2026-01-07T13:45:10.480636Z","close_reason":"22 GitHub issues closed manually and remaining 15 migrated to TASKS phases or beads"}
{"id":"AssurancePlatform-dpk","title":"Phase 2: Platform Stabilisation","description":"Epic for Phase 2 of the TEA Platform development roadmap. Focus: stabilising the deployed platform, improving developer experience, and cleaning up technical debt from the Django to Next.js migration.\n\nSub-phases:\n- 2a: DevOps \u0026 CI/CD\n- 2b: Documentation Migration  \n- 2b': Curriculum Module System\n- 2c: Technical Cleanup\n- 2d: Auth Cleanup\n\nExit Criteria:\n- CI/CD pipeline runs reliably without manual intervention\n- Documentation builds cleanly with Nextra\n- No duplicate dependencies in bundle\n- Legacy code removed or documented","status":"open","priority":1,"issue_type":"epic","created_at":"2026-01-07T12:57:48.508141Z","created_by":"cburr","updated_at":"2026-01-07T12:57:48.508141Z"}
{"id":"AssurancePlatform-na6","title":"Reset password functionality","description":"Users need the ability to reset their password via email link.\n\nGitHub Issue: #642\n\nRequirements:\n- Set up SMTP and TURING 'from' email address (requires IT support)\n- 'Forgot password' link on login page\n- Email sent with password reset link\n- Token valid for 30-60 minutes\n\nStatus: BLOCKED - waiting on IT for SMTP configuration details.\n\nAcceptance Criteria:\n- [ ] SMTP configured with Turing email address\n- [ ] Forgot password link on login page\n- [ ] Password reset email sent successfully\n- [ ] Token expires after 30-60 minutes\n- [ ] User can set new password via reset link","status":"open","priority":0,"issue_type":"task","created_at":"2026-01-07T13:43:26.52922Z","created_by":"cburr","updated_at":"2026-01-07T13:43:26.52922Z","labels":["auth"]}
{"id":"AssurancePlatform-qxo","title":"Security: Add rate limiting to critical endpoints","description":"Several security-critical endpoints lack rate limiting:\n\n**Affected endpoints:**\n- /api/users/register - Account creation (spam/bot registrations)\n- /api/invites/[token]/accept - Invite acceptance (brute-force token guessing)\n\nNote: Password reset DOES have rate limiting in the service layer.\n\n**Impact:**\n- User enumeration attacks\n- Brute-force invite token guessing\n- Denial of service through resource exhaustion\n- Bot/spam registrations\n\n**Fix:** Implement rate limiting at the API route level using Next.js middleware. Consider IP-based and user-based limits.\n\n**Confidence:** 85%","status":"open","priority":1,"issue_type":"bug","created_at":"2025-12-24T10:27:27.006088Z","updated_at":"2025-12-24T10:27:27.006088Z","labels":["rate-limiting","security"]}
{"id":"AssurancePlatform-swc","title":"Security: Validate session keys against database revocation","description":"The isValidSession function in lib/auth-helpers.ts (lines 7-30) only performs client-side validation and doesn't check if the refresh token has been revoked in the database.\n\n**Issue:** This function checks for session key expiry but doesn't validate that the key is actually valid in the database (via the revokedAt field in RefreshToken table).\n\n**Attack Scenario:**\n1. User logs in, gets session with refresh token\n2. Admin revokes all user's tokens (security incident)\n3. User's JWT still contains the key and hasn't expired\n4. isValidSession returns true, allowing continued access\n\n**Fix:** Ensure all security-critical code paths use validateRefreshToken() from the refresh-token-service which does proper database validation, or add a note clarifying this is for quick UI checks only.\n\n**Confidence:** 82%","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-24T10:27:32.943297Z","updated_at":"2025-12-24T10:27:32.943297Z","labels":["auth","security"]}
{"id":"AssurancePlatform-tk1","title":"Phase 2b: Documentation Migration (Docusaurus to Nextra)","description":"Migrate documentation from Docusaurus to Nextra for better Next.js integration.\n\nTasks:\n- [x] Evaluate Nextra configuration options\n- [x] Create Nextra project structure\n- [x] Migrate MDX content files\n- [x] Adapt custom React components\n- [x] Configure navigation ordering (_meta.ts files)\n- [x] Process pageMap for hidden items\n- [ ] Configure search (Flexsearch) - DEFERRED\n- [x] Set up CI/CD for docs deployment\n- [x] Update documentation URLs/redirects (/documentation â†’ /docs)\n\nStructure:\n- content/ directory with MDX files\n- components/docs/ for documentation-specific components\n- Nextra 4.x (App Router compatible)\n\nDeferred:\n- Search functionality (Flexsearch)\n- Versioning","status":"tombstone","priority":0,"issue_type":"task","created_at":"2026-01-07T12:58:03.913543Z","created_by":"cburr","updated_at":"2026-01-07T13:00:15.696017Z","labels":["documentation"],"deleted_at":"2026-01-07T13:00:15.696017Z","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"AssurancePlatform-uvd","title":"Phase 2a: DevOps \u0026 CI/CD","description":"Address CI/CD pipeline issues and improve deployment reliability.\n\nTasks:\n- [x] Audit current CI/CD pipeline configuration\n- [x] Implement health check endpoint (/api/health)\n- [x] Add pre-build validation (lint + type-check)\n- [x] Add deployment error handling with retry\n- [x] Add deployment notifications (GitHub summaries)\n- [x] Configure Azure health probe\n\nFiles changed:\n- app/api/health/route.ts (created)\n- .github/workflows/build.yaml (modified)\n- biome.json (modified)\n\nAcceptance Criteria:\n- /api/health returns 200 when DB connected, 503 when not\n- Lint/type-check failures block builds\n- Webhook retries on failure\n- Deployments complete without manual intervention","status":"tombstone","priority":0,"issue_type":"task","created_at":"2026-01-07T12:58:03.593812Z","created_by":"cburr","updated_at":"2026-01-07T13:00:12.657522Z","labels":["devops"],"deleted_at":"2026-01-07T13:00:12.657522Z","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"AssurancePlatform-wk0","title":"Security: Enable email verification for invite acceptance","description":"The acceptInvite function in lib/services/case-permission-service.ts (lines 706-710) has email verification commented out, allowing any authenticated user to accept invites meant for specific email addresses.\n\n**Attack Scenario:**\n1. Admin invites alice@company.com with ADMIN permissions\n2. Attacker bob@attacker.com creates account and logs in\n3. Bob intercepts/discovers the invite token\n4. Bob accepts the invite and gains ADMIN access to the case\n\n**Impact:** Authorization bypass allowing privilege escalation.\n\n**Fix:** Enable the email verification check that is already implemented but commented out.\n\n**Confidence:** 90%","status":"open","priority":0,"issue_type":"bug","created_at":"2025-12-24T10:27:11.529298Z","updated_at":"2025-12-24T10:27:11.529298Z","labels":["auth","security"]}
{"id":"AssurancePlatform-yiy","title":"Add search functionality to documentation (Flexsearch)","description":"The Nextra documentation site currently has no search functionality.\n\nImplement Flexsearch for documentation search as deferred from Phase 2b.\n\nLocation: content/ and components/docs/","status":"tombstone","priority":3,"issue_type":"task","created_at":"2026-01-07T13:00:45.986902Z","created_by":"cburr","updated_at":"2026-01-07T13:02:12.953997Z","labels":["documentation"],"deleted_at":"2026-01-07T13:02:12.953997Z","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
