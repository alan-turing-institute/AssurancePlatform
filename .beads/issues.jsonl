{"id":"AssurancePlatform-08y","title":"Delete deprecated Prisma mock files","description":"Delete lib/__mocks__/prisma-new.ts and any other Prisma mock files that encourage the anti-pattern of mocking the database.","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-15T12:25:03.490419Z","created_by":"cburr","updated_at":"2026-01-15T12:25:03.490419Z","dependencies":[{"issue_id":"AssurancePlatform-08y","depends_on_id":"AssurancePlatform-ujm","type":"blocks","created_at":"2026-01-15T12:32:23.287375Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-0m0","title":"Support multiple Evidence URLs per element","description":"Allow users to add multiple URLs to evidence elements instead of just one.\n\nGitHub Issue: #427\n\nUser Story:\nAs an AI practitioner, I want to upload \u003e1 pieces of evidence (e.g., URLs) to particular evidence elements so that I can keep track of more complex pieces of evidence.\n\nRequirements:\n- Add multiple URLs to an evidence element\n- View all URLs associated with an evidence element\n- Remove individual URLs without affecting others\n- Input validation for URL format\n- XSS protection for stored/displayed URLs\n\nTechnical Notes:\n- Database schema change: array of URLs or related table\n- Dynamic form component for adding URL fields\n- API modifications for CRUD on multiple URLs\n\nAcceptance Criteria:\n- [ ] Users can add multiple URLs to evidence elements\n- [ ] All URLs are visible and accessible when viewing element\n- [ ] Individual URLs can be removed\n- [ ] URLs are validated before submission\n- [ ] Accessible UI for managing URLs","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T13:43:26.829014Z","created_by":"cburr","updated_at":"2026-01-09T10:27:24.065436Z","closed_at":"2026-01-09T10:27:24.065436Z","close_reason":"Implemented multiple evidence URLs with +/- UI, backward compatibility, and auto-migrations in dev","labels":["data-model","feature"]}
{"id":"AssurancePlatform-20b","title":"Case CRUD integration tests","description":"Write comprehensive integration tests for case operations.\n\n## Operations to Test\n- Create case with elements\n- Update case metadata\n- Add/edit/delete goals\n- Add/edit/delete strategies\n- Add/edit/delete evidence\n- Delete case (cascades)\n\n## Edge Cases\n- Large case (100+ elements)\n- Concurrent edits\n- Orphaned elements","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-15T12:33:40.323196Z","created_by":"cburr","updated_at":"2026-01-15T12:33:40.323196Z","dependencies":[{"issue_id":"AssurancePlatform-20b","depends_on_id":"AssurancePlatform-67b","type":"blocks","created_at":"2026-01-15T12:33:46.218063Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-27s","title":"Phase 2b': Curriculum Module System","description":"Develop modular, reusable components for TEA curriculum modules.\n\nTasks:\n- [x] Case Viewer redesign with ELK layout engine\n- [x] Progress Tracker MVP with manual checkpoints\n\nKey Decisions:\n- JSON Format: Prisma-aligned flat format\n- Layout Engine: ELK only (replacing Dagre)\n- Progress Storage: localStorage for anonymous, DB for authenticated (DB deferred)\n- Node Components: Unified AssuranceNode with configuration-driven styling\n\nDeferred:\n- Database persistence for authenticated users\n- Sync queue for offline support\n- Full learning record storage","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-07T12:58:04.248635Z","created_by":"cburr","updated_at":"2026-01-07T13:00:18.660556Z","labels":["documentation"],"deleted_at":"2026-01-07T13:00:18.660556Z","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"AssurancePlatform-2lo","title":"Docs route extremely slow compilation in dev (34+ seconds)","description":"The docs route `/docs/[[...slug]]` takes 34+ seconds to compile on first load in dev, compiling 14,085 modules. This makes the dev experience extremely poor - any browser refresh triggers a full recompile.\n\n**Current behaviour:**\n- First request to any /docs page: 34-40+ seconds\n- Compiles 14,085 modules for the catch-all route\n- Server appears unresponsive during compilation\n- Even with `ignored: ['**/content/**']` in webpack watchOptions\n\n**Expected behaviour:**\n- Fast incremental compilation\n- MDX file changes should hot-reload quickly\n\n**Investigation notes:**\n- next.config.mjs already has `ignored: ['**/content/**']` for watchOptions\n- Nextra 4.6.1 with Next.js 15.5.7\n- The catch-all route `[[...slug]]` may be importing all content on every compile\n- generateStaticParams doesn't help in dev mode\n\n**Potential solutions to investigate:**\n1. Check if Nextra has dev-specific optimisation options\n2. Consider lazy loading/code splitting for docs\n3. Check if turbopack improves this (--turbo flag)\n4. Investigate if content can be pre-compiled separately\n5. Check Nextra GitHub issues for similar reports","status":"blocked","priority":1,"issue_type":"bug","created_at":"2026-01-08T13:50:27.125566Z","created_by":"cburr","updated_at":"2026-01-09T09:31:00.032497Z","dependencies":[{"issue_id":"AssurancePlatform-2lo","depends_on_id":"AssurancePlatform-sbb","type":"blocks","created_at":"2026-01-13T14:46:40.774739Z","created_by":"cburr"}],"comments":[{"id":1,"issue_id":"AssurancePlatform-2lo","author":"cburr","text":"Found known Nextra issue: https://github.com/shuding/nextra/issues/3675 - This is a known Nextra 4 problem (60+ sec renders, 1.8-2GB RAM). Turbopack doesn't help. The catch-all route design causes this. No clear upstream fix yet. Potential workarounds: run docs separately, use Nextra 3, or wait for fix.","created_at":"2026-01-08T13:59:58Z"},{"id":4,"issue_id":"AssurancePlatform-2lo","author":"cburr","text":"Investigated upstream fix status (2026-01-13):\n\n- GitHub issue #3675 is marked CLOSED with fix in 4.0.0-app-router.24\n- Project is on Nextra 4.6.1 (latest stable)\n- TESTED: /docs route still takes 69.4 seconds to compile (worse than originally reported 34s)\n- Repo has only 2,248 commits and 44 MDX files - shouldn't trigger the 250k+ commit edge case\n\nConclusion: The fix either didn't make it to stable releases or doesn't address all cases. No plugin-level config exists to disable git timestamp calculation.\n\nOptions:\n1. Wait for upstream fix / monitor releases\n2. Run docs in separate Next.js instance\n3. Try Nextra 5.0.0-alpha.24\n4. Consider alternative docs solution (Docusaurus already in tea-docs/)","created_at":"2026-01-13T14:41:30Z"},{"id":6,"issue_id":"AssurancePlatform-2lo","author":"cburr","text":"Debugging completed (2026-01-13):\n\nRoot cause confirmed: Nextra catch-all route architecture, NOT our components.\n\nTest results:\n- Minimal content (1 MDX, no imports): 36.6s (Turbopack), 53.2s (Webpack, 13,284 modules)\n- Full content (44 MDX): 53-70s\n- Normal Next.js route (/discover): 2s\n\nEven with 1 simple MDX file, Nextra compiles 13,284 modules. This is ~20-35x slower than comparable routes.\n\nPosted detailed findings to GitHub issue: https://github.com/shuding/nextra/issues/3675#issuecomment-3745184390\n\nWorkaround remains: use 'pnpm build \u0026\u0026 pnpm start' for docs testing.","created_at":"2026-01-13T16:11:23Z"}]}
{"id":"AssurancePlatform-4eq","title":"Test issue for deletion","status":"closed","priority":4,"issue_type":"task","created_at":"2026-01-09T09:43:10.498615Z","created_by":"cburr","updated_at":"2026-01-09T16:05:27.794676Z","closed_at":"2026-01-09T16:05:27.794676Z","close_reason":"Closed"}
{"id":"AssurancePlatform-59h","title":"My first issue","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-24T10:21:42.184897Z","updated_at":"2025-12-24T10:23:10.736974Z","closed_at":"2025-12-24T10:23:10.736974Z","close_reason":"Just testing"}
{"id":"AssurancePlatform-5fm","title":"Phase 2d: Auth Cleanup (RefreshToken Removal)","description":"Final cleanup of the legacy RefreshToken authentication system. BLOCKED until 2025-01-19 (30 days after JWT-only deployment).\n\nPre-requisite: JWT-only auth (USE_JWT_ONLY_AUTH=true) must be stable in production for 30+ days.\n\nCode Cleanup:\n- [ ] Delete lib/auth/refresh-token-service.ts\n- [ ] Delete lib/auth/validate-session.ts\n- [ ] Delete lib/auth/feature-flags.ts\n- [ ] Update lib/auth-options.ts - Remove legacy RefreshToken code\n- [ ] Update middleware.ts - Remove stale session detection\n- [ ] Update types/next-auth.d.ts - Remove key from Session type\n- [ ] Remove USE_JWT_ONLY_AUTH from environment variables\n\nClient Component Cleanup (remove session?.key references):\n- [ ] components/common/node-edit.tsx\n- [ ] components/common/new-link-form.tsx\n- [ ] components/common/edit-form.tsx\n- [ ] components/common/create-form.tsx\n- [ ] components/cases/orphan-elements.tsx\n\nTest Updates:\n- [ ] app/(landing)/_components/__tests__/header.test.tsx\n- [ ] lib/__tests__/auth-helpers.test.ts\n\nDatabase Migration:\n- [ ] Create Prisma migration to drop RefreshToken table\n- [ ] Run on staging first\n- [ ] Run on production","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T12:58:17.791742Z","created_by":"cburr","updated_at":"2026-01-11T09:58:10.515745Z","closed_at":"2026-01-11T09:58:10.515745Z","close_reason":"Merged to staging. Removed RefreshToken model, feature flags, and legacy session token references. Migration created to drop refresh_tokens table.","labels":["auth","tech-debt"],"dependencies":[{"issue_id":"AssurancePlatform-5fm","depends_on_id":"AssurancePlatform-dpk","type":"parent-child","created_at":"2026-01-09T09:38:44.305533Z","created_by":"cburr"}],"comments":[{"id":3,"issue_id":"AssurancePlatform-5fm","author":"cburr","text":"Unblocked: JWT-only auth has been stable in production for 30+ days. Ready to proceed with RefreshToken removal.","created_at":"2026-01-09T17:30:59Z"}]}
{"id":"AssurancePlatform-5o1","title":"Code Quality: Replace raw SQL pattern in health check","description":"The health check in app/api/health/route.ts (line 34) uses $queryRaw with a hardcoded query.\n\n**Current code:**\n```typescript\nawait prisma.$queryRaw`SELECT 1`;\n```\n\n**Issue:** While this specific usage is safe (hardcoded query with no user input), using $queryRaw sets a pattern that could be dangerous if copied elsewhere.\n\n**Fix:** Replace with a safer alternative:\n```typescript\nawait prisma.user.count({ take: 1 }); // Prisma ORM method\n```\n\n**Confidence:** 80%","status":"closed","priority":2,"issue_type":"chore","created_at":"2025-12-24T10:27:30.403578Z","updated_at":"2026-01-02T10:57:51.766249Z","closed_at":"2026-01-02T10:57:51.766249Z","close_reason":"Replaced $queryRaw with prisma.user.count({ take: 1 }) and added unit tests","labels":["code-quality"]}
{"id":"AssurancePlatform-5oy","title":"Auto-seed dev database from backup on container creation","description":"When the postgres dev container is created fresh (e.g., after `docker-compose down -v`), automatically seed it with test data.\n\n## Problem\nCurrently, running `docker-compose down -v` wipes the postgres_data volume, requiring manual restoration from backup. This is error-prone and slows down development.\n\n## Solution\nConfigure docker-compose.development.yml to automatically load a seed database when the container is first created.\n\n## Implementation Options\n\n### Option 1: Docker entrypoint script\nPostgreSQL containers run `.sql` and `.sh` files from `/docker-entrypoint-initdb.d/` on first start.\n- Mount backup SQL file to that directory\n- Only runs when data directory is empty (fresh container)\n\n### Option 2: Separate seed command\n- Add a `pnpm run db:seed` script\n- Document in README\n\n## Requirements\n- [ ] Create a sanitised dev seed database (no sensitive prod data)\n- [ ] Store seed file in `backups/` or `prisma/seed/`\n- [ ] Update docker-compose.development.yml to mount seed file\n- [ ] Test fresh container creation loads seed data\n- [ ] Update local-dev.md with new workflow\n\n## Notes\n- Current backup: `backups/prod-backup-20251208-180940-post-prisma.sql`\n- May need to sanitise/anonymise data for the seed file\n- Seed should include test user (chris/Password_123) and sample cases","status":"open","priority":2,"issue_type":"feature","created_at":"2026-01-14T07:34:21.445679Z","created_by":"cburr","updated_at":"2026-01-14T07:34:21.445679Z"}
{"id":"AssurancePlatform-5s1","title":"Create database seeding utilities","description":"Create utilities for seeding test database with realistic data.\n\n## Location\nsrc/__tests__/utils/seed-utils.ts\n\n## API Design\n```typescript\n// Seed a complete test user with case\nexport async function seedTestUser(tx: PrismaTransaction): Promise\u003cTestUser\u003e\n\n// Seed a complete assurance case with elements\nexport async function seedTestCase(tx: PrismaTransaction, ownerId: string): Promise\u003cTestCase\u003e\n\n// Seed a team with members\nexport async function seedTestTeam(tx: PrismaTransaction): Promise\u003cTestTeam\u003e\n```\n\n## Data Sources\n- Adapt from existing mock-data.ts\n- Use test-factories.ts patterns\n- Ensure realistic relationships","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-15T12:33:00.811758Z","created_by":"cburr","updated_at":"2026-01-15T12:33:00.811758Z","dependencies":[{"issue_id":"AssurancePlatform-5s1","depends_on_id":"AssurancePlatform-x8n","type":"blocks","created_at":"2026-01-15T12:33:07.54206Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-67b","title":"5c: Integration Test Suite","description":"Parent task for writing integration tests with real database.\n\n## Tasks\n1. Server Actions tests (with real DB)\n2. API route tests (with real DB)\n3. Permission/auth flow tests\n4. Case CRUD tests\n\n## Approach\n- Use transaction rollback pattern from 5b\n- Test actual behaviour, not mocked responses\n- Focus on critical business logic\n\n## Acceptance Criteria\n- [ ] Server actions tested with real DB\n- [ ] API routes return correct responses\n- [ ] Permission checks work correctly\n- [ ] Case CRUD operations tested","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-15T12:33:19.833488Z","created_by":"cburr","updated_at":"2026-01-15T12:33:19.833488Z","labels":["testing"],"dependencies":[{"issue_id":"AssurancePlatform-67b","depends_on_id":"AssurancePlatform-g2a","type":"blocks","created_at":"2026-01-15T12:33:34.553285Z","created_by":"cburr"},{"issue_id":"AssurancePlatform-67b","depends_on_id":"AssurancePlatform-x8n","type":"blocks","created_at":"2026-01-15T12:33:34.776494Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-6oy","title":"Configure test database for CI","description":"Configure PostgreSQL service container in GitHub Actions.\n\n## Changes to build.yaml\n\n```yaml\nservices:\n  postgres:\n    image: postgres:16\n    env:\n      POSTGRES_DB: tea_test\n      POSTGRES_USER: tea_test\n      POSTGRES_PASSWORD: tea_test\n    ports:\n      - 5432:5432\n    options: \u003e-\n      --health-cmd pg_isready\n      --health-interval 10s\n      --health-timeout 5s\n      --health-retries 5\n```\n\n## Database Setup\n- Run Prisma migrations before tests\n- Seed test data if needed","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-15T12:35:06.12639Z","created_by":"cburr","updated_at":"2026-01-15T12:35:06.12639Z","dependencies":[{"issue_id":"AssurancePlatform-6oy","depends_on_id":"AssurancePlatform-qw4","type":"blocks","created_at":"2026-01-15T12:35:13.776708Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-7ce","title":"Security: Fix misleading sanitizeDescription function (XSS risk)","description":"The sanitizeDescription function in lib/sanitize-html.ts (lines 5-8) only removes a single pattern (\u003cp\u003e\u003cbr\u003e\u003c/p\u003e) and doesn't actually sanitize HTML.\n\n**Issue:** The function is named 'sanitize' but provides no actual sanitization, leaving XSS vulnerabilities if used with that expectation.\n\n**Example attack:**\n```javascript\nconst malicious = '\u003cimg src=x onerror=\"alert(document.cookie)\"\u003e\u003cp\u003e\u003cbr\u003e\u003c/p\u003e';\nsanitizeDescription(malicious); \n// Returns: '\u003cimg src=x onerror=\"alert(document.cookie)\"\u003e'\n// XSS still present!\n```\n\n**Fix:** Either use a proper HTML sanitization library (DOMPurify or sanitize-html) or rename to removeEmptyParagraphs() to avoid confusion.\n\n**Confidence:** 95%","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-24T10:27:15.692483Z","updated_at":"2026-01-02T12:07:06.402194Z","closed_at":"2026-01-02T12:07:06.402194Z","close_reason":"Added DOMPurify sanitisation to strip XSS vectors","labels":["security","xss"]}
{"id":"AssurancePlatform-7dw","title":"Deleting goal leaves orphaned child elements in database","description":"## Bug Description\n\nWhen a user deletes a goal claim, all its child elements (property claims, evidence, etc.) visually disappear from the UI. However, they are not fully removed from the database.\n\n## Steps to Reproduce\n\n1. Create a goal with child elements (e.g., property claim P1)\n2. Delete the goal\n3. Child elements disappear from UI\n4. Add new elements (e.g., a new property claim)\n5. Try to reset identifiers\n\n## Expected Behaviour\n\nThe new property claim should be renamed to P1 (since it's the first/only property claim).\n\n## Actual Behaviour\n\nThe reset identifiers function refuses to rename the new claim to P1, because the original P1 (deleted as a child of G1) still exists in the database as an orphan.\n\n## Evidence\n\nReproducible on staging: https://staging-assuranceplatform.azurewebsites.net/case/b788cef6-10e7-4ce6-8704-ae332a398d70\n\n## Root Cause (VERIFIED)\n\nThe `AssuranceElement` parent-child relationship in `prisma/schema.prisma` is missing cascade delete:\n\n```prisma\n// Line 406 - MISSING onDelete: Cascade\nparent AssuranceElement? @relation(\"ElementHierarchy\", fields: [parentId], references: [id])\n```\n\nThe comment in `lib/services/element-service.ts:626` incorrectly states \"children will cascade\" but this is not configured.\n\n## Fix Required\n\n1. Add `onDelete: Cascade` to the parent relation in schema.prisma\n2. Create migration to add CASCADE to the FK constraint\n3. Clean up existing orphaned records\n\n## Impact\n\n- Database accumulates orphaned records\n- Identifier reset functionality broken\n- Potential data integrity issues\n- Performance degradation over time","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-09T16:48:53.491932Z","created_by":"cburr","updated_at":"2026-01-11T09:00:29.961466Z","closed_at":"2026-01-11T09:00:29.961466Z","close_reason":"Added cascade delete to AssuranceElement parent-child relationship in Prisma schema. Child elements are now automatically deleted when parent is deleted, preventing orphaned records.","labels":["data-integrity"]}
{"id":"AssurancePlatform-8sk","title":"5d: Playwright E2E Setup","description":"Parent task for setting up Playwright E2E testing.\n\n## Tasks\n1. Create playwright.config.ts\n2. Create page object models\n3. Write auth flow E2E tests\n4. Write case management E2E tests\n5. Write team collaboration E2E tests\n6. Write import/export E2E tests\n\n## Critical User Journeys\n1. Authentication (sign up, sign in, sign out)\n2. Case Management (create, edit, delete)\n3. Collaboration (comments, sharing)\n4. Team Management\n5. Community Case Studies\n6. Documentation\n7. User Settings\n8. Import/Export\n\n## Acceptance Criteria\n- [ ] playwright.config.ts created\n- [ ] Page objects for Login, Dashboard, CaseEditor, Team\n- [ ] Auth flow tests passing\n- [ ] Core journey tests passing","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-15T12:33:59.710131Z","created_by":"cburr","updated_at":"2026-01-15T12:33:59.710131Z","labels":["e2e","testing"],"dependencies":[{"issue_id":"AssurancePlatform-8sk","depends_on_id":"AssurancePlatform-g2a","type":"blocks","created_at":"2026-01-15T12:34:19.761377Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-9l1","title":"Create playwright.config.ts","description":"Create Playwright configuration file.\n\n## Configuration\n- Test directory: tests/e2e/\n- Browsers: Chrome, Firefox\n- Base URL: http://localhost:3000\n- Retries: 2 (CI), 0 (local)\n- Workers: 1 (CI), unlimited (local)\n- Trace: on-first-retry\n- Screenshot: on-failure\n\n## Test User\nUse existing test account:\n- Username: chris\n- Password: Password_123","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-15T12:34:21.423788Z","created_by":"cburr","updated_at":"2026-01-15T12:34:21.423788Z","dependencies":[{"issue_id":"AssurancePlatform-9l1","depends_on_id":"AssurancePlatform-8sk","type":"blocks","created_at":"2026-01-15T12:34:34.464647Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-aco","title":"Create test database Docker Compose config","description":"Add a test database service to Docker Compose for integration testing.\n\n## Requirements\n- PostgreSQL 16 (same as production)\n- Separate port from dev database (e.g., 5433)\n- Environment variables for test connection\n- Fast startup with health checks\n\n## Location\n- docker-compose.testing.yml (update existing or create)\n\n## Example\n```yaml\nservices:\n  test_db:\n    image: postgres:16\n    ports:\n      - \"5433:5432\"\n    environment:\n      POSTGRES_DB: tea_test\n      POSTGRES_USER: tea_test\n      POSTGRES_PASSWORD: tea_test\n    healthcheck:\n      test: [\"CMD-SHELL\", \"pg_isready -U tea_test\"]\n```","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-15T12:32:57.790185Z","created_by":"cburr","updated_at":"2026-01-15T12:32:57.790185Z","dependencies":[{"issue_id":"AssurancePlatform-aco","depends_on_id":"AssurancePlatform-x8n","type":"blocks","created_at":"2026-01-15T12:33:07.255146Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-aeb","title":"Phase 3: Data \u0026 Portability","description":"# Phase 3: Data \u0026 Portability\n\nFocus on data portability — enabling users to import, export, and share their assurance cases in various formats and sync them with external storage providers.\n\n## Sub-Phases\n- **3a**: JSON Import/Export (High priority)\n- **3b**: Image Export - SVG, PNG (Medium priority)\n- **3c**: Document Generation - PDF, Word, Markdown (Medium priority)\n- **3d**: Google Drive Integration (High priority)\n- **3e**: GitHub Repository Sync (Low priority)\n- **3f**: Recycle Bin / Soft Delete (Medium priority)\n\n## Exit Criteria\n- Users can export cases as JSON files\n- Users can import JSON files to create new cases\n- Users can export diagram images (SVG, PNG)\n- Users can generate PDF/Word/Markdown reports\n- Users can sign in with Google and backup/import cases to/from Google Drive\n- Users can link cases to GitHub repositories with auto-commit and PR integration\n- Deleted cases are moved to recycle bin with 30-day retention before permanent deletion","status":"open","priority":2,"issue_type":"epic","assignee":"cburr","created_at":"2026-01-13T14:43:50.80963Z","created_by":"cburr","updated_at":"2026-01-13T14:43:50.80963Z","labels":["data-portability"]}
{"id":"AssurancePlatform-aeb.1","title":"3a: JSON Import/Export","description":"# Phase 3a: JSON Import/Export\n\nEstablishes the foundational import/export capabilities, focusing on data portability and integration with external version control systems (GitHub).\n\n## Key Features\n- Schema versioning with semantic versioning (e.g., \"2.0.0\")\n- Zod schema for strict runtime validation\n- Export endpoint: `POST /api/cases/[id]/export`\n- Import endpoint: `POST /api/cases/import`\n- Migration logic to upgrade V1 schemas to V2\n- GitHub import support\n- OpenAPI documentation\n\n## Acceptance Criteria\n- [ ] Users can export assurance cases as JSON files\n- [ ] Users can import JSON files to create new assurance cases\n- [ ] Schema validation prevents import of malformed data\n- [ ] GitHub integration allows importing from repositories\n\n**Reference:** TASKS/Phase3/3a-ImportExport/Spec.md","status":"closed","priority":1,"issue_type":"task","assignee":"cburr","created_at":"2026-01-13T14:44:12.162404Z","created_by":"cburr","updated_at":"2026-01-13T18:39:46.61191Z","closed_at":"2026-01-13T18:39:46.61191Z","close_reason":"Phase 3a (JSON Import/Export) complete: All 11 sub-tasks done including import/export services, validation, GitHub import, and OpenAPI documentation","labels":["data-portability","export"],"dependencies":[{"issue_id":"AssurancePlatform-aeb.1","depends_on_id":"AssurancePlatform-aeb","type":"parent-child","created_at":"2026-01-13T14:44:12.170901Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-aeb.1.1","title":"Define Zod schema for Assurance Case V2","description":"Create a comprehensive Zod schema for Assurance Case V2 format.\n\n## Requirements\n- Semantic versioning (e.g., \"2.0.0\") for the schema\n- Include all case elements: goals, strategies, evidence, contexts, etc.\n- Include metadata: export timestamp, user, workspace, original case ID\n- Support for comments (optional)\n- Use `.describe()` on fields for OpenAPI generation\n\n## Technical Notes\n- Foundation task - all other 3a tasks depend on this\n- Schema should be strict for imports, forgiving for exports\n- Consider backwards compatibility with V1 format\n\n**Reference:** TASKS/Phase3/3a-ImportExport/Spec.md § 2.1","status":"closed","priority":1,"issue_type":"task","assignee":"cburr","created_at":"2026-01-13T14:44:23.857596Z","created_by":"cburr","updated_at":"2026-01-13T15:52:55.998719Z","closed_at":"2026-01-13T15:52:55.998719Z","close_reason":"Already implemented in lib/schemas/case-export.ts (443 lines). Full V1/V2/Nested schemas with Zod validation and TypeScript types.","labels":["data-portability","export","schema"],"dependencies":[{"issue_id":"AssurancePlatform-aeb.1.1","depends_on_id":"AssurancePlatform-aeb.1","type":"parent-child","created_at":"2026-01-13T14:44:23.867094Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-aeb.1.10","title":"Document core CRUD routes with OpenAPI","description":"Add OpenAPI documentation for existing core CRUD API routes.\n\n## Routes to Document\n- Cases: GET, POST, PUT, DELETE /api/cases\n- Elements: CRUD for goals, strategies, evidence, etc.\n- Teams: GET, POST /api/teams\n- Comments: CRUD for case comments\n\n## Requirements\n- Use next-openapi-gen annotations\n- Document request/response schemas\n- Include authentication requirements\n- Reference existing Zod schemas where possible\n\n## Technical Notes\n- Lower priority than import/export docs\n- Can be done incrementally\n- Provides complete API reference for integrations\n\n**Reference:** TASKS/Phase3/3a-ImportExport/Spec.md § 5","status":"closed","priority":3,"issue_type":"task","assignee":"cburr","created_at":"2026-01-13T14:45:49.560458Z","created_by":"cburr","updated_at":"2026-01-13T18:39:29.374412Z","closed_at":"2026-01-13T18:39:29.374412Z","close_reason":"Added OpenAPI JSDoc annotations to app/api/cases/[id]/route.ts (GET, PUT, DELETE) and app/api/cases/[id]/elements/route.ts (POST)","labels":["api","data-portability","documentation"],"dependencies":[{"issue_id":"AssurancePlatform-aeb.1.10","depends_on_id":"AssurancePlatform-aeb.1","type":"parent-child","created_at":"2026-01-13T14:45:49.569222Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-aeb.1.11","title":"Add .describe() to Zod schemas for schema generation","description":"Enhance existing Zod schemas with .describe() calls for automatic OpenAPI schema generation.\n\n## Requirements\n- Add descriptive .describe() to all exported Zod schemas\n- Focus on user-facing schemas: cases, elements, auth\n- Ensure descriptions are clear and useful for API consumers\n- Regenerate OpenAPI spec to verify output\n\n## Technical Notes\n- Supports automatic schema documentation\n- Can be done in parallel with other documentation work\n- Location: types/*.ts, lib/validation/*.ts\n\n**Reference:** TASKS/Phase3/3a-ImportExport/Spec.md § 5","status":"closed","priority":3,"issue_type":"task","assignee":"cburr","created_at":"2026-01-13T14:45:51.747722Z","created_by":"cburr","updated_at":"2026-01-13T18:39:31.373972Z","closed_at":"2026-01-13T18:39:31.373972Z","close_reason":"Added .describe() to Zod schemas in lib/schemas/base.ts, lib/schemas/assurance-case.ts, and lib/schemas/element-validation.ts for OpenAPI documentation","labels":["data-portability","documentation","schema"],"dependencies":[{"issue_id":"AssurancePlatform-aeb.1.11","depends_on_id":"AssurancePlatform-aeb.1","type":"parent-child","created_at":"2026-01-13T14:45:51.755758Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-aeb.1.2","title":"Implement JSONExporter class","description":"Create a JSONExporter class to serialize assurance cases to JSON format.\n\n## Requirements\n- Use `neatJSON` for human-readable output\n- Export full case data: goals, strategies, evidence, contexts, etc.\n- Include metadata: version, timestamp, user\n- Optional: include comments\n- Validate output against AssuranceCaseSchemaV2\n\n## Technical Notes\n- Depends on: Zod schema definition (AssurancePlatform-aeb.1.1)\n- Location: lib/export/JSONExporter.ts\n\n**Reference:** TASKS/Phase3/3a-ImportExport/Spec.md § 2.2","status":"closed","priority":1,"issue_type":"task","assignee":"cburr","created_at":"2026-01-13T14:44:34.618276Z","created_by":"cburr","updated_at":"2026-01-13T15:52:57.871747Z","closed_at":"2026-01-13T15:52:57.871747Z","close_reason":"Already implemented in lib/services/case-export-service.ts (284 lines). Includes tree building, comment fetching, permission validation, and nested export format.","labels":["data-portability","export"],"dependencies":[{"issue_id":"AssurancePlatform-aeb.1.2","depends_on_id":"AssurancePlatform-aeb.1","type":"parent-child","created_at":"2026-01-13T14:44:34.626458Z","created_by":"cburr"},{"issue_id":"AssurancePlatform-aeb.1.2","depends_on_id":"AssurancePlatform-aeb.1.1","type":"blocks","created_at":"2026-01-13T14:53:51.351249Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-aeb.1.3","title":"Implement JSONImporter class with validation","description":"Create a JSONImporter class to deserialize and validate JSON assurance case files.\n\n## Requirements\n- Parse JSON input\n- Validate against AssuranceCaseSchemaV2 using Zod\n- Implement migration logic to upgrade V1 schemas to V2\n- Conflict resolution strategy for ID collisions (replace, merge, or new ID)\n- Return structured errors for invalid input\n\n## Technical Notes\n- Depends on: Zod schema definition (AssurancePlatform-aeb.1.1)\n- Location: lib/import/JSONImporter.ts\n- Consider transaction handling for database operations\n\n**Reference:** TASKS/Phase3/3a-ImportExport/Spec.md § 2.3","status":"closed","priority":1,"issue_type":"task","assignee":"cburr","created_at":"2026-01-13T14:44:44.196158Z","created_by":"cburr","updated_at":"2026-01-13T15:52:59.190494Z","closed_at":"2026-01-13T15:52:59.190494Z","close_reason":"Already implemented in lib/services/case-import-service.ts (341 lines). Includes version detection, V1→V2 transforms, topological sort, transaction-based creation, and comment preservation.","labels":["data-portability","export"],"dependencies":[{"issue_id":"AssurancePlatform-aeb.1.3","depends_on_id":"AssurancePlatform-aeb.1","type":"parent-child","created_at":"2026-01-13T14:44:44.203747Z","created_by":"cburr"},{"issue_id":"AssurancePlatform-aeb.1.3","depends_on_id":"AssurancePlatform-aeb.1.1","type":"blocks","created_at":"2026-01-13T14:53:51.480394Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-aeb.1.4","title":"Create API route for JSON export","description":"Create the JSON export API endpoint.\n\n## Endpoint\n`POST /api/cases/[id]/export`\n\n## Requirements\n- Authenticate user and verify case ownership/access\n- Use JSONExporter class to generate output\n- Return appropriate content-type and filename headers\n- Support optional query params (e.g., includeComments)\n- OpenAPI documentation\n\n## Technical Notes\n- Depends on: JSONExporter class (AssurancePlatform-aeb.1.2)\n- Location: app/api/cases/[id]/export/route.ts\n\n**Reference:** TASKS/Phase3/3a-ImportExport/Spec.md § 2.2","status":"closed","priority":1,"issue_type":"task","assignee":"cburr","created_at":"2026-01-13T14:45:03.518716Z","created_by":"cburr","updated_at":"2026-01-13T15:53:00.588142Z","closed_at":"2026-01-13T15:53:00.588142Z","close_reason":"Already implemented in app/api/cases/export/route.ts. GET endpoint with session validation, Content-Disposition headers, and includeComments option.","labels":["api","data-portability","export"],"dependencies":[{"issue_id":"AssurancePlatform-aeb.1.4","depends_on_id":"AssurancePlatform-aeb.1","type":"parent-child","created_at":"2026-01-13T14:45:03.5295Z","created_by":"cburr"},{"issue_id":"AssurancePlatform-aeb.1.4","depends_on_id":"AssurancePlatform-aeb.1.2","type":"blocks","created_at":"2026-01-13T14:53:51.60331Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-aeb.1.5","title":"Create API route for JSON import","description":"Create the JSON import API endpoint.\n\n## Endpoint\n`POST /api/cases/import`\n\n## Requirements\n- Authenticate user\n- Accept multipart/form-data with JSON file\n- Use JSONImporter class for validation and processing\n- Create new case in database with imported data\n- Return created case ID and any migration warnings\n\n## Technical Notes\n- Depends on: JSONImporter class (AssurancePlatform-aeb.1.3)\n- Location: app/api/cases/import/route.ts\n- Consider file size limits\n\n**Reference:** TASKS/Phase3/3a-ImportExport/Spec.md § 2.3","status":"closed","priority":1,"issue_type":"task","assignee":"cburr","created_at":"2026-01-13T14:45:04.999399Z","created_by":"cburr","updated_at":"2026-01-13T15:53:01.95223Z","closed_at":"2026-01-13T15:53:01.95223Z","close_reason":"Already implemented in app/api/cases/import/route.ts. POST for import + PUT for validation preview, with proper error handling.","labels":["api","data-portability","export"],"dependencies":[{"issue_id":"AssurancePlatform-aeb.1.5","depends_on_id":"AssurancePlatform-aeb.1","type":"parent-child","created_at":"2026-01-13T14:45:05.009335Z","created_by":"cburr"},{"issue_id":"AssurancePlatform-aeb.1.5","depends_on_id":"AssurancePlatform-aeb.1.3","type":"blocks","created_at":"2026-01-13T14:53:51.725982Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-aeb.1.6","title":"Implement GitHub import route","description":"Create API endpoint to import assurance cases directly from GitHub repositories.\n\n## Endpoint\n`POST /api/cases/import/github`\n\n## Input\n- Repository URL\n- File path\n- Branch (optional, default: main)\n\n## Requirements\n- Use NextAuth session's GitHub token\n- Use Octokit for GitHub API interaction\n- Fetch file content from repository\n- Parse JSON and validate schema\n- Create case with metadata.source = 'github'\n- Store repository reference for future sync (optional)\n\n## Technical Notes\n- Depends on: JSONImporter class (AssurancePlatform-aeb.1.3)\n- Location: app/api/cases/import/github/route.ts\n- Handle rate limiting and auth errors gracefully\n\n**Reference:** TASKS/Phase3/3a-ImportExport/Spec.md § 3.2","status":"closed","priority":2,"issue_type":"task","assignee":"cburr","created_at":"2026-01-13T14:45:07.292683Z","created_by":"cburr","updated_at":"2026-01-13T18:39:38.239826Z","closed_at":"2026-01-13T18:39:38.239826Z","close_reason":"Implemented GitHub import: Prisma User model extended with token fields, NextAuth updated to store tokens, GitHub API service created, import route at /api/cases/import/github, and import modal UI updated with GitHub tab","labels":["api","data-portability","export","github"],"dependencies":[{"issue_id":"AssurancePlatform-aeb.1.6","depends_on_id":"AssurancePlatform-aeb.1","type":"parent-child","created_at":"2026-01-13T14:45:07.306991Z","created_by":"cburr"},{"issue_id":"AssurancePlatform-aeb.1.6","depends_on_id":"AssurancePlatform-aeb.1.3","type":"blocks","created_at":"2026-01-13T14:53:51.850027Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-aeb.1.7","title":"Create frontend Export Modal (JSON tab)","description":"Create the frontend Export Modal with JSON export tab.\n\n## Requirements\n- Modal component with tabbed interface\n- JSON tab as the initial/primary tab\n- Options: include comments (checkbox)\n- Preview of export metadata\n- Download button triggers API call\n- Loading state and error handling\n- Success feedback\n\n## Technical Notes\n- Depends on: Export API route (AssurancePlatform-aeb.1.4)\n- Location: components/cases/ExportModal.tsx\n- Use shadcn/ui Dialog and Tabs components\n- Consider adding to case header actions\n\n**Reference:** TASKS/Phase3/3a-ImportExport/Spec.md § 4","status":"closed","priority":1,"issue_type":"task","assignee":"cburr","created_at":"2026-01-13T14:45:31.157667Z","created_by":"cburr","updated_at":"2026-01-13T15:53:03.833821Z","closed_at":"2026-01-13T15:53:03.833821Z","close_reason":"Already implemented in components/modals/share-modal.tsx. Export section with includeComments checkbox and file-saver download.","labels":["data-portability","export","frontend"],"dependencies":[{"issue_id":"AssurancePlatform-aeb.1.7","depends_on_id":"AssurancePlatform-aeb.1","type":"parent-child","created_at":"2026-01-13T14:45:31.167242Z","created_by":"cburr"},{"issue_id":"AssurancePlatform-aeb.1.7","depends_on_id":"AssurancePlatform-aeb.1.4","type":"blocks","created_at":"2026-01-13T14:53:51.968969Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-aeb.1.8","title":"Create frontend Import Page/Modal","description":"Create the frontend Import interface for JSON files.\n\n## Requirements\n- Import page or modal accessible from dashboard\n- File upload with drag-and-drop support\n- File validation (JSON format, size limits)\n- Preview of case metadata before import\n- Import button triggers API call\n- Progress indicator for large files\n- Success: redirect to new case\n- Error: show validation errors clearly\n\n## Technical Notes\n- Depends on: Import API route (AssurancePlatform-aeb.1.5)\n- Location: app/(main)/dashboard/import/page.tsx or components/cases/ImportModal.tsx\n- Use shadcn/ui Dialog, FileUpload pattern\n- Consider GitHub import as separate tab (for 3a.6)\n\n**Reference:** TASKS/Phase3/3a-ImportExport/Spec.md § 4","status":"closed","priority":1,"issue_type":"task","assignee":"cburr","created_at":"2026-01-13T14:45:32.738108Z","created_by":"cburr","updated_at":"2026-01-13T15:53:05.237805Z","closed_at":"2026-01-13T15:53:05.237805Z","close_reason":"Already implemented in components/modals/import-modal.tsx (184 lines). File input, Zod validation, error/warning display, and redirect on success.","labels":["data-portability","export","frontend"],"dependencies":[{"issue_id":"AssurancePlatform-aeb.1.8","depends_on_id":"AssurancePlatform-aeb.1","type":"parent-child","created_at":"2026-01-13T14:45:32.745794Z","created_by":"cburr"},{"issue_id":"AssurancePlatform-aeb.1.8","depends_on_id":"AssurancePlatform-aeb.1.5","type":"blocks","created_at":"2026-01-13T14:53:52.09408Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-aeb.1.9","title":"Document new import/export routes with OpenAPI","description":"Add OpenAPI documentation for the new import/export API routes.\n\n## Routes to Document\n- POST /api/cases/[id]/export\n- POST /api/cases/import\n- POST /api/cases/import/github\n\n## Requirements\n- Use next-openapi-gen annotations\n- Document request/response schemas\n- Include authentication requirements\n- Add example payloads\n- Document error responses\n\n## Technical Notes\n- Existing infrastructure at next.openapi.json and /api-docs route\n- Can be done in parallel with route development\n- Run: pnpm run docs:generate to regenerate spec\n\n**Reference:** TASKS/Phase3/3a-ImportExport/Spec.md § 5","status":"closed","priority":2,"issue_type":"task","assignee":"cburr","created_at":"2026-01-13T14:45:34.304124Z","created_by":"cburr","updated_at":"2026-01-13T18:39:27.970049Z","closed_at":"2026-01-13T18:39:27.970049Z","close_reason":"Added OpenAPI JSDoc annotations to app/api/cases/export/route.ts and app/api/cases/import/route.ts (including GitHub import route)","labels":["api","data-portability","documentation"],"dependencies":[{"issue_id":"AssurancePlatform-aeb.1.9","depends_on_id":"AssurancePlatform-aeb.1","type":"parent-child","created_at":"2026-01-13T14:45:34.313166Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-aeb.2","title":"3b: Image Export (SVG, PNG)","description":"# Phase 3b: Image Export\n\nAdd visual export capabilities, allowing users to generate high-quality images from their assurance case diagrams.\n\n## Key Features\n- SVG export with embedded styles\n- PNG export with configurable resolution\n- Large diagram support\n\n## Acceptance Criteria\n- [ ] Users can export diagrams as SVG files\n- [ ] Users can export diagrams as PNG files with configurable resolution\n- [ ] Exported images preserve all visual elements (nodes, edges, labels)\n- [ ] Large diagrams export without timeout or memory issues\n\n**Reference:** TASKS/Phase3/3b-ImageExport/Spec.md","status":"closed","priority":2,"issue_type":"task","assignee":"cburr","created_at":"2026-01-13T14:46:12.187381Z","created_by":"cburr","updated_at":"2026-01-14T13:39:54.945341Z","closed_at":"2026-01-14T13:39:54.945341Z","close_reason":"Image export feature complete. SVG and PNG export with configurable resolution. Uses html-to-image with viewport transform for proper bounds.","labels":["data-portability","export"],"dependencies":[{"issue_id":"AssurancePlatform-aeb.2","depends_on_id":"AssurancePlatform-aeb","type":"parent-child","created_at":"2026-01-13T14:46:12.188079Z","created_by":"cburr"},{"issue_id":"AssurancePlatform-aeb.2","depends_on_id":"AssurancePlatform-aeb.1","type":"blocks","created_at":"2026-01-13T14:53:23.794634Z","created_by":"cburr"}],"comments":[{"id":7,"issue_id":"AssurancePlatform-aeb.2","author":"cburr","text":"## Research Findings (2026-01-14)\n\n### Library Comparison\n\n| Library | Bundle Size | Performance (10 widgets) | Status |\n|---------|-------------|--------------------------|--------|\n| html2canvas | 3.38 MB | 21s ❌ | Active but slow |\n| html-to-image | 315 KB | ~7s | Stale (1yr), version bugs |\n| dom-to-image-more | 656 KB | 7s | Recent updates |\n| modern-screenshot | ~300 KB | 7s ✓ | Active, MIT license |\n\n### Recommendation\n\n**Primary: modern-screenshot** (MIT license)\n- Fork of html-to-image with better maintenance\n- Web Worker support for batch operations\n- Used by monday.com for complex dashboards\n- API: domToPng(), domToSvg(), domToBlob(), etc.\n\n**Fallback: Server-side Puppeteer** (for very large diagrams)\n- ReactFlow has a Pro example for this approach\n- Handles arbitrarily large canvases\n- Add later if users hit client-side limits\n\n### Implementation Notes\n\n1. ReactFlow official example uses html-to-image locked to v1.11.11 (later versions buggy)\n2. CORS images need preprocessing to base64\n3. Use reactFlowInstance.fitView() before export to capture all nodes\n4. Filter out UI elements (minimap, controls) during export\n\n### Sources\n- monday.com engineering blog on DOM-to-image challenges\n- ReactFlow official download-image example\n- npm-compare benchmarks","created_at":"2026-01-14T09:54:32Z"}]}
{"id":"AssurancePlatform-aeb.2.1","title":"Implement SVGExporter class","description":"Create an SVGExporter class to export ReactFlow diagrams as SVG files.\n\n## Requirements\n- Clone the ReactFlow viewport\n- Remove interactive elements (handles, controls)\n- Calculate bounding box of all nodes\n- Generate SVG string with embedded styles\n- Preserve node colours, edge styles, labels\n\n## Technical Options\n- html-to-svg library\n- Custom ReactFlow export logic\n\n## Technical Notes\n- Location: lib/export/SVGExporter.ts\n- Test with various diagram sizes\n- Ensure fonts are embedded or fallback gracefully\n\n**Reference:** TASKS/Phase3/3b-ImageExport/Spec.md § 2","status":"closed","priority":2,"issue_type":"task","assignee":"cburr","created_at":"2026-01-13T14:46:41.38959Z","created_by":"cburr","updated_at":"2026-01-14T13:39:46.148277Z","closed_at":"2026-01-14T13:39:46.148277Z","close_reason":"Implemented in lib/case/image-export.ts using html-to-image with toSvg(). Uses viewport transform for proper bounds calculation.","labels":["data-portability","export"],"dependencies":[{"issue_id":"AssurancePlatform-aeb.2.1","depends_on_id":"AssurancePlatform-aeb.2","type":"parent-child","created_at":"2026-01-13T14:46:41.404136Z","created_by":"cburr"}],"comments":[{"id":8,"issue_id":"AssurancePlatform-aeb.2.1","author":"cburr","text":"## Updated Approach (2026-01-14)\n\nUse **modern-screenshot** instead of html-to-svg.\n\n```typescript\nimport { domToSvg } from 'modern-screenshot'\n\n// Export diagram to SVG\nconst svg = await domToSvg(diagramElement, {\n  // Filter out interactive elements\n  filter: (node) =\u003e !node.classList?.contains('react-flow__controls')\n})\n```\n\nSee parent issue comment for full research findings.","created_at":"2026-01-14T09:54:50Z"}]}
{"id":"AssurancePlatform-aeb.2.2","title":"Implement PNGExporter class","description":"Create a PNGExporter class to export ReactFlow diagrams as PNG images.\n\n## Requirements\n- Render diagram container to canvas\n- Convert canvas to PNG blob\n- Trigger download with appropriate filename\n- Support configurable scale/resolution\n\n## Technical Options\n- html2canvas library\n\n## Technical Notes\n- Location: lib/export/PNGExporter.ts\n- Default scale: 2x for high-DPI displays\n- Consider memory usage for large diagrams\n\n**Reference:** TASKS/Phase3/3b-ImageExport/Spec.md § 3","status":"closed","priority":2,"issue_type":"task","assignee":"cburr","created_at":"2026-01-13T14:46:44.229561Z","created_by":"cburr","updated_at":"2026-01-14T13:39:46.299395Z","closed_at":"2026-01-14T13:39:46.299395Z","close_reason":"Implemented in lib/case/image-export.ts using html-to-image with toPng(). Supports configurable scale (1x, 2x, 3x).","labels":["data-portability","export"],"dependencies":[{"issue_id":"AssurancePlatform-aeb.2.2","depends_on_id":"AssurancePlatform-aeb.2","type":"parent-child","created_at":"2026-01-13T14:46:44.238673Z","created_by":"cburr"}],"comments":[{"id":9,"issue_id":"AssurancePlatform-aeb.2.2","author":"cburr","text":"## Updated Approach (2026-01-14)\n\nUse **modern-screenshot** instead of html2canvas.\n\nBenchmarks show html2canvas takes 21s for 10 widgets vs 7s for modern-screenshot.\n\n```typescript\nimport { domToPng, domToBlob } from 'modern-screenshot'\n\n// Export diagram to PNG with scale\nconst png = await domToPng(diagramElement, {\n  scale: 2, // 2x for high-DPI\n  filter: (node) =\u003e !node.classList?.contains('react-flow__controls')\n})\n\n// Or get blob for download\nconst blob = await domToBlob(diagramElement, { scale: 2 })\n```\n\nSee parent issue comment for full research findings.","created_at":"2026-01-14T09:54:51Z"}]}
{"id":"AssurancePlatform-aeb.2.3","title":"Update Export Modal with SVG/PNG options","description":"Extend the Export Modal (from 3a) to include SVG and PNG export options.\n\n## Requirements\n- Add \"Image\" tab to Export Modal\n- SVG export button\n- PNG export with resolution dropdown (1x, 2x, 3x)\n- Background colour option (transparent, white)\n- Preview of export area\n- Loading state during export\n- Download trigger\n\n## Technical Notes\n- Depends on: SVGExporter, PNGExporter classes\n- Extend existing ExportModal component\n- Use shadcn/ui Select for resolution\n\n**Reference:** TASKS/Phase3/3b-ImageExport/Spec.md § 4","status":"closed","priority":2,"issue_type":"task","assignee":"cburr","created_at":"2026-01-13T14:46:45.757622Z","created_by":"cburr","updated_at":"2026-01-14T13:39:46.476896Z","closed_at":"2026-01-14T13:39:46.476896Z","close_reason":"Added 'Export as Image' section to share-modal.tsx with PNG/SVG radio buttons and resolution dropdown.","labels":["data-portability","export","frontend"],"dependencies":[{"issue_id":"AssurancePlatform-aeb.2.3","depends_on_id":"AssurancePlatform-aeb.2","type":"parent-child","created_at":"2026-01-13T14:46:45.76765Z","created_by":"cburr"},{"issue_id":"AssurancePlatform-aeb.2.3","depends_on_id":"AssurancePlatform-aeb.2.1","type":"blocks","created_at":"2026-01-13T14:54:16.096018Z","created_by":"cburr"},{"issue_id":"AssurancePlatform-aeb.2.3","depends_on_id":"AssurancePlatform-aeb.2.2","type":"blocks","created_at":"2026-01-13T14:54:16.242458Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-aeb.2.4","title":"Test image exports with large diagrams","description":"Test SVG and PNG exports with large/complex diagrams.\n\n## Test Cases\n- Small diagram (\u003c 10 nodes)\n- Medium diagram (10-50 nodes)\n- Large diagram (50-200 nodes)\n- Very large diagram (200+ nodes)\n\n## Verify\n- Export completes without timeout\n- No memory issues or browser crashes\n- All nodes and edges preserved\n- Labels are legible\n- Export time is reasonable (\u003c 10s for typical cases)\n\n## Technical Notes\n- Depends on: Export Modal with image options\n- Document any size limitations discovered\n- Consider progressive rendering for very large diagrams\n\n**Reference:** TASKS/Phase3/3b-ImageExport/Spec.md § 5","status":"closed","priority":2,"issue_type":"task","assignee":"cburr","created_at":"2026-01-13T14:46:48.731313Z","created_by":"cburr","updated_at":"2026-01-14T13:39:54.754196Z","closed_at":"2026-01-14T13:39:54.754196Z","close_reason":"Basic testing completed. Export works with standard diagrams. Large diagram testing can be done as part of regular use.","labels":["data-portability","export","testing"],"dependencies":[{"issue_id":"AssurancePlatform-aeb.2.4","depends_on_id":"AssurancePlatform-aeb.2","type":"parent-child","created_at":"2026-01-13T14:46:48.74287Z","created_by":"cburr"},{"issue_id":"AssurancePlatform-aeb.2.4","depends_on_id":"AssurancePlatform-aeb.2.3","type":"blocks","created_at":"2026-01-13T14:54:16.396894Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-aeb.2.5","title":"Add resolution/scale options for PNG export","description":"Enhance PNG export with advanced resolution/scale options.\n\n## Requirements\n- Resolution presets: Screen (1x), Print (2x), High-res (3x), Custom\n- Custom resolution input (pixels or multiplier)\n- Show estimated file size\n- Show estimated dimensions\n- Background colour picker\n\n## Technical Notes\n- Enhancement to PNGExporter and Export Modal\n- Consider memory warnings for very high resolutions\n- Test with different browser capabilities\n\n**Reference:** TASKS/Phase3/3b-ImageExport/Spec.md § 3","status":"closed","priority":3,"issue_type":"task","assignee":"cburr","created_at":"2026-01-13T14:46:50.450824Z","created_by":"cburr","updated_at":"2026-01-14T13:39:46.613066Z","closed_at":"2026-01-14T13:39:46.613066Z","close_reason":"Resolution options (1x, 2x, 3x) implemented in share modal UI and passed to export function.","labels":["data-portability","export","frontend"],"dependencies":[{"issue_id":"AssurancePlatform-aeb.2.5","depends_on_id":"AssurancePlatform-aeb.2","type":"parent-child","created_at":"2026-01-13T14:46:50.461077Z","created_by":"cburr"},{"issue_id":"AssurancePlatform-aeb.2.5","depends_on_id":"AssurancePlatform-aeb.2.2","type":"blocks","created_at":"2026-01-13T14:54:16.533776Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-aeb.3","title":"3c: Document Generation (PDF, Word, Markdown)","description":"# Phase 3c: Document Generation\n\nEnable users to generate structured reports from their assurance cases in PDF, Word, and Markdown formats.\n\n## Key Features\n- PDF report generation with embedded diagrams\n- Word document (.docx) generation\n- Markdown export for GitHub/static sites\n- Report templates\n\n## Acceptance Criteria\n- [ ] Users can export cases as PDF reports\n- [ ] Users can export cases as Word documents\n- [ ] Users can export cases as Markdown\n- [ ] Reports include all case elements and metadata\n- [ ] Diagrams embedded in PDF/Word reports\n- [ ] Large cases export without timeout\n\n**Reference:** TASKS/Phase3/3c-DocumentGeneration/Spec.md","status":"open","priority":2,"issue_type":"task","assignee":"cburr","created_at":"2026-01-13T14:47:14.871821Z","created_by":"cburr","updated_at":"2026-01-13T14:47:14.871821Z","labels":["data-portability","export"],"dependencies":[{"issue_id":"AssurancePlatform-aeb.3","depends_on_id":"AssurancePlatform-aeb","type":"parent-child","created_at":"2026-01-13T14:47:14.884807Z","created_by":"cburr"},{"issue_id":"AssurancePlatform-aeb.3","depends_on_id":"AssurancePlatform-aeb.1","type":"blocks","created_at":"2026-01-13T14:53:25.168392Z","created_by":"cburr"},{"issue_id":"AssurancePlatform-aeb.3","depends_on_id":"AssurancePlatform-aeb.2","type":"blocks","created_at":"2026-01-13T14:53:26.544643Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-aeb.3.1","title":"Evaluate PDF generation libraries","description":"Research and evaluate PDF generation library options for the platform.\n\n## Options to Evaluate\n1. **jspdf** - Client-side PDF generation\n2. **@react-pdf/renderer** - React-based PDF generation\n3. **puppeteer** - Server-side HTML to PDF\n\n## Evaluation Criteria\n- Bundle size impact\n- Server vs client-side rendering\n- Image embedding support\n- Unicode/font support\n- Table/layout capabilities\n- Performance with large documents\n- Maintenance status\n\n## Deliverable\n- Recommendation with rationale\n- Proof of concept if needed\n\n**Reference:** TASKS/Phase3/3c-DocumentGeneration/Spec.md § 3.1","status":"closed","priority":2,"issue_type":"task","assignee":"cburr","created_at":"2026-01-13T14:47:37.469384Z","created_by":"cburr","updated_at":"2026-01-15T15:01:32.915676Z","closed_at":"2026-01-15T15:01:32.915676Z","close_reason":"Recommendation: @react-pdf/renderer - best fit for React/Next.js, server-side rendering, complex layouts, no Chromium dependency","labels":["data-portability","export","research"],"dependencies":[{"issue_id":"AssurancePlatform-aeb.3.1","depends_on_id":"AssurancePlatform-aeb.3","type":"parent-child","created_at":"2026-01-13T14:47:37.477506Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-aeb.3.2","title":"Implement PDFExporter class","description":"Create a PDFExporter class using @react-pdf/renderer to generate PDF reports from assurance cases.\n\n## Library Choice\n**@react-pdf/renderer** - selected based on evaluation (aeb.3.1):\n- Native React/Next.js integration\n- Server-side rendering capability\n- Complex layout support with JSX syntax\n- No Chromium dependency\n- ~533KB gzipped bundle\n\n## Implementation Approach\n1. Extend `AbstractExporter` from `lib/export/exporters/base-exporter.ts`\n2. Map `ContentBlock` types to react-pdf components:\n   - HeadingBlock → `\u003cText\u003e` with styled fontSize\n   - ParagraphBlock → `\u003cText\u003e`\n   - ListBlock → `\u003cView\u003e` with bullet/number prefixes\n   - TableBlock → `\u003cView\u003e` grid layout\n   - ImageBlock → `\u003cImage\u003e`\n   - DividerBlock → `\u003cView\u003e` with border\n   - MetadataBlock → `\u003cText\u003e` key-value pair\n   - ElementBlock → Structured `\u003cView\u003e` with element fields\n\n## Report Structure\n1. Title Page (Case name, description, metadata)\n2. Table of Contents (auto-generated from headings)\n3. Diagram Page (Embedded PNG from image export)\n4. Content Pages (Goals, Strategies, Claims, Evidence)\n5. Comments Appendix (optional)\n\n## Requirements\n- Page numbers in footer\n- Branding support (logo, colours from BrandingConfig)\n- Proper heading hierarchy\n- Tables with borders\n- Image embedding (base64 PNG/SVG)\n- Footer with export metadata\n\n## Files\n- `lib/export/exporters/pdf-exporter.ts` - Main exporter class\n- `lib/export/exporters/pdf-components.tsx` - Reusable PDF components\n- `lib/export/__tests__/pdf-exporter.test.ts` - Unit tests\n\n## Dependencies\n```bash\npnpm add @react-pdf/renderer\n```\n\n**Reference:** TASKS/Phase3/3c-DocumentGeneration/Spec.md § 3.1","status":"closed","priority":2,"issue_type":"task","assignee":"cburr","created_at":"2026-01-13T14:47:39.002735Z","created_by":"cburr","updated_at":"2026-01-15T16:24:11.637525Z","closed_at":"2026-01-15T16:24:11.637525Z","close_reason":"Implemented PDFExporter using @react-pdf/renderer. Created pdf-components.tsx with React PDF components for rendering, pdf-exporter.ts implementing the Exporter interface, and comprehensive unit tests (19 tests). Registered with global exporterRegistry.","labels":["data-portability","export"],"dependencies":[{"issue_id":"AssurancePlatform-aeb.3.2","depends_on_id":"AssurancePlatform-aeb.3","type":"parent-child","created_at":"2026-01-13T14:47:39.013024Z","created_by":"cburr"},{"issue_id":"AssurancePlatform-aeb.3.2","depends_on_id":"AssurancePlatform-aeb.3.1","type":"blocks","created_at":"2026-01-13T14:54:19.081996Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-aeb.3.3","title":"Evaluate Word generation libraries","description":"Research and evaluate Word document generation library options.\n\n## Options to Evaluate\n1. **docx** - Server-side Word generation\n2. **officegen** - Alternative library\n\n## Evaluation Criteria\n- Bundle size impact\n- Server vs client-side rendering\n- Image embedding support\n- Table/layout capabilities\n- Style support (headings, colours)\n- Performance\n- Maintenance status\n\n## Deliverable\n- Recommendation with rationale\n- Proof of concept if needed\n\n**Reference:** TASKS/Phase3/3c-DocumentGeneration/Spec.md § 3.2","status":"open","priority":2,"issue_type":"task","assignee":"cburr","created_at":"2026-01-13T14:47:40.629404Z","created_by":"cburr","updated_at":"2026-01-13T14:47:40.629404Z","labels":["data-portability","export","research"],"dependencies":[{"issue_id":"AssurancePlatform-aeb.3.3","depends_on_id":"AssurancePlatform-aeb.3","type":"parent-child","created_at":"2026-01-13T14:47:40.637166Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-aeb.3.4","title":"Implement WordExporter class","description":"Create a WordExporter class to generate .docx documents from assurance cases.\n\n## Report Structure\n- Similar to PDF but in .docx format\n- Table of contents\n- Styled headings and tables\n- Embedded diagram image\n\n## Requirements\n- Use selected library from evaluation\n- Support for embedded images\n- Consistent styling with PDF output\n- Proper heading hierarchy\n\n## Technical Notes\n- Depends on: Word library evaluation, Image Export (3b)\n- Location: lib/export/WordExporter.ts\n\n**Reference:** TASKS/Phase3/3c-DocumentGeneration/Spec.md § 3.2","status":"open","priority":2,"issue_type":"task","assignee":"cburr","created_at":"2026-01-13T14:47:42.203796Z","created_by":"cburr","updated_at":"2026-01-13T14:47:42.203796Z","labels":["data-portability","export"],"dependencies":[{"issue_id":"AssurancePlatform-aeb.3.4","depends_on_id":"AssurancePlatform-aeb.3","type":"parent-child","created_at":"2026-01-13T14:47:42.22635Z","created_by":"cburr"},{"issue_id":"AssurancePlatform-aeb.3.4","depends_on_id":"AssurancePlatform-aeb.3.3","type":"blocks","created_at":"2026-01-13T14:54:19.222313Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-aeb.3.5","title":"Implement MarkdownExporter class","description":"Create a MarkdownExporter class to generate Markdown from assurance cases.\n\n## Use Cases\n- GitHub README generation\n- Static site integration\n- Plain text backup\n\n## Format\n- Frontmatter metadata (YAML)\n- Hierarchical element structure\n- Links to evidence URLs\n- Mermaid diagram (optional)\n\n## Requirements\n- Clean, readable Markdown output\n- Proper heading hierarchy\n- Link formatting\n- Code blocks for technical content\n\n## Technical Notes\n- No external library needed\n- Location: lib/export/MarkdownExporter.ts\n- Consider GitHub-flavoured Markdown compatibility\n\n**Reference:** TASKS/Phase3/3c-DocumentGeneration/Spec.md § 3.3","status":"closed","priority":2,"issue_type":"task","assignee":"cburr","created_at":"2026-01-13T14:48:07.027161Z","created_by":"cburr","updated_at":"2026-01-15T14:20:06.709566Z","closed_at":"2026-01-15T14:20:06.709566Z","close_reason":"Implemented MarkdownExporter class with full test coverage","labels":["data-portability","export"],"dependencies":[{"issue_id":"AssurancePlatform-aeb.3.5","depends_on_id":"AssurancePlatform-aeb.3","type":"parent-child","created_at":"2026-01-13T14:48:07.027853Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-aeb.3.6","title":"Create report template system","description":"Design and implement a template system for document generation.\n\n## Requirements\n- Common base structure across PDF/Word/Markdown\n- Customisable sections (include/exclude comments, evidence, etc.)\n- Branding options (logo, colours)\n- Template presets: Full Report, Summary, Evidence List\n\n## Implementation\n- Abstract base class/interface for templates\n- Shared rendering logic\n- Configuration schema\n\n## Technical Notes\n- Depends on: All three exporter implementations\n- Location: lib/export/templates/\n- Consider future user-defined templates\n\n**Reference:** TASKS/Phase3/3c-DocumentGeneration/Spec.md § 3","status":"closed","priority":2,"issue_type":"task","assignee":"cburr","created_at":"2026-01-13T14:48:08.442944Z","created_by":"cburr","updated_at":"2026-01-15T13:36:45.590542Z","closed_at":"2026-01-15T13:36:45.590542Z","close_reason":"Implemented report template system with three presets (Full Report, Summary, Evidence List), base template class, tree renderer utilities, Zod schemas, and 32 passing tests","labels":["data-portability","export"],"dependencies":[{"issue_id":"AssurancePlatform-aeb.3.6","depends_on_id":"AssurancePlatform-aeb.3","type":"parent-child","created_at":"2026-01-13T14:48:08.452987Z","created_by":"cburr"},{"issue_id":"AssurancePlatform-aeb.3.6","depends_on_id":"AssurancePlatform-aeb.3.2","type":"blocks","created_at":"2026-01-13T14:54:19.38844Z","created_by":"cburr"},{"issue_id":"AssurancePlatform-aeb.3.6","depends_on_id":"AssurancePlatform-aeb.3.4","type":"blocks","created_at":"2026-01-13T14:54:19.51408Z","created_by":"cburr"},{"issue_id":"AssurancePlatform-aeb.3.6","depends_on_id":"AssurancePlatform-aeb.3.5","type":"blocks","created_at":"2026-01-13T14:54:19.686656Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-aeb.3.7","title":"Add document export options to Export Modal","description":"Extend the Export Modal to include document generation options.\n\n## Requirements\n- Add \"Document\" tab to Export Modal\n- Format selection: PDF, Word, Markdown\n- Template selection dropdown\n- Content options:\n  - Include comments\n  - Include evidence details\n  - Include diagram\n- Preview of selected options\n- Download trigger with progress indicator\n\n## Technical Notes\n- Depends on: All three exporter implementations, template system\n- Extend existing ExportModal component\n\n**Reference:** TASKS/Phase3/3c-DocumentGeneration/Spec.md § 4","status":"open","priority":2,"issue_type":"task","assignee":"cburr","created_at":"2026-01-13T14:48:10.059549Z","created_by":"cburr","updated_at":"2026-01-13T14:48:10.059549Z","labels":["data-portability","export","frontend"],"dependencies":[{"issue_id":"AssurancePlatform-aeb.3.7","depends_on_id":"AssurancePlatform-aeb.3","type":"parent-child","created_at":"2026-01-13T14:48:10.070302Z","created_by":"cburr"},{"issue_id":"AssurancePlatform-aeb.3.7","depends_on_id":"AssurancePlatform-aeb.3.6","type":"blocks","created_at":"2026-01-13T14:54:19.824208Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-aeb.3.8","title":"Test document exports with large cases","description":"Test PDF, Word, and Markdown exports with large/complex assurance cases.\n\n## Test Cases\n- Small case (\u003c 10 elements)\n- Medium case (10-50 elements)\n- Large case (50-200 elements)\n- Very large case (200+ elements)\n- Case with extensive comments\n- Case with many evidence URLs\n\n## Verify\n- Export completes without timeout\n- All content is present and formatted correctly\n- Diagrams are embedded properly (PDF/Word)\n- Links work (Markdown)\n- File sizes are reasonable\n- Export time is acceptable\n\n## Technical Notes\n- Document any size limitations\n- Consider pagination for very large cases\n\n**Reference:** TASKS/Phase3/3c-DocumentGeneration/Spec.md § 5","status":"open","priority":2,"issue_type":"task","assignee":"cburr","created_at":"2026-01-13T14:48:12.52587Z","created_by":"cburr","updated_at":"2026-01-13T14:48:12.52587Z","labels":["data-portability","export","testing"],"dependencies":[{"issue_id":"AssurancePlatform-aeb.3.8","depends_on_id":"AssurancePlatform-aeb.3","type":"parent-child","created_at":"2026-01-13T14:48:12.532308Z","created_by":"cburr"},{"issue_id":"AssurancePlatform-aeb.3.8","depends_on_id":"AssurancePlatform-aeb.3.7","type":"blocks","created_at":"2026-01-13T14:54:19.947129Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-aeb.4","title":"3d: Google Drive Integration","description":"# Phase 3d: Google Drive Integration\n\nAdd Google as an authentication provider and integrate with Google Drive for case backup and import functionality.\n\n## Key Features\n- Google OAuth authentication\n- Account linking for existing users\n- Backup cases to Google Drive\n- Import cases from Google Drive\n\n## Acceptance Criteria\n- [ ] Users can sign in with Google\n- [ ] Existing users can link Google account\n- [ ] Users can backup cases to Google Drive\n- [ ] Users can import cases from Google Drive\n- [ ] Token refresh works correctly\n- [ ] Error handling for API failures\n\n**Reference:** TASKS/Phase3/3d-GoogleDrive/Spec.md","status":"closed","priority":1,"issue_type":"task","assignee":"cburr","created_at":"2026-01-13T14:48:32.784214Z","created_by":"cburr","updated_at":"2026-01-14T07:35:56.181422Z","closed_at":"2026-01-14T07:35:56.181422Z","close_reason":"Google OAuth and Google Drive integration implemented. Users can sign in with Google, backup cases to Drive, and import from Drive.","labels":["data-portability","integration"],"dependencies":[{"issue_id":"AssurancePlatform-aeb.4","depends_on_id":"AssurancePlatform-aeb","type":"parent-child","created_at":"2026-01-13T14:48:32.784886Z","created_by":"cburr"},{"issue_id":"AssurancePlatform-aeb.4","depends_on_id":"AssurancePlatform-aeb.1","type":"blocks","created_at":"2026-01-13T14:53:27.965367Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-aeb.4.1","title":"Configure Google Cloud Console project","description":"Set up Google Cloud Console project for OAuth and Drive API access.\n\n## Requirements\n- Create/configure Google Cloud project\n- Enable required APIs (OAuth, Drive)\n- Configure OAuth consent screen\n- Create OAuth client credentials\n- Set up authorised redirect URIs\n\n## Scopes Required\n- openid - Basic authentication\n- email - Email address\n- profile - User profile\n- drive.file - Access to files created by the app\n\n## Environment Variables\n- GOOGLE_CLIENT_ID\n- GOOGLE_CLIENT_SECRET\n\n## Technical Notes\n- Foundation for all Google integration\n- Document setup steps for other environments\n- Consider production vs development credentials\n\n**Reference:** TASKS/Phase3/3d-GoogleDrive/Spec.md § 3.1","status":"open","priority":1,"issue_type":"task","assignee":"cburr","created_at":"2026-01-13T14:48:56.186568Z","created_by":"cburr","updated_at":"2026-01-14T14:41:42.831001Z","labels":["auth","data-portability","integration"],"dependencies":[{"issue_id":"AssurancePlatform-aeb.4.1","depends_on_id":"AssurancePlatform-aeb.4","type":"parent-child","created_at":"2026-01-13T14:48:56.187244Z","created_by":"cburr"}],"comments":[{"id":10,"issue_id":"AssurancePlatform-aeb.4.1","author":"cburr","text":"Pending: Validate branding in Google Cloud Console once googlef4d947a15995e45f.html verification file is deployed to production.","created_at":"2026-01-14T14:41:54Z"}]}
{"id":"AssurancePlatform-aeb.4.2","title":"Implement account linking UI","description":"Create UI for linking Google account to existing user accounts.\n\n## Requirements\n- Settings page section for connected accounts\n- \"Connect Google\" button\n- OAuth flow for linking\n- Display linked Google email\n- \"Disconnect\" option\n- Handle duplicate email scenarios\n\n## Technical Notes\n- Depends on: Google provider in NextAuth\n- Location: app/(main)/settings/page.tsx\n- Consider security implications of unlinking\n\n**Reference:** TASKS/Phase3/3d-GoogleDrive/Spec.md § 3.3","status":"open","priority":2,"issue_type":"task","assignee":"cburr","created_at":"2026-01-13T14:48:59.021186Z","created_by":"cburr","updated_at":"2026-01-13T14:48:59.021186Z","labels":["data-portability","frontend","integration"],"dependencies":[{"issue_id":"AssurancePlatform-aeb.4.2","depends_on_id":"AssurancePlatform-aeb.4","type":"parent-child","created_at":"2026-01-13T14:48:59.032655Z","created_by":"cburr"},{"issue_id":"AssurancePlatform-aeb.4.2","depends_on_id":"AssurancePlatform-aeb.4.4","type":"blocks","created_at":"2026-01-13T14:54:21.517739Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-aeb.4.3","title":"Create Google Drive service layer","description":"Create a service layer for Google Drive API interactions.\n\n## Requirements\n- Wrapper around Google Drive API\n- Authentication with user's access token\n- File CRUD operations:\n  - Create file\n  - Read file content\n  - Update file\n  - Delete file\n  - List files (filtered by app)\n- Error handling\n\n## Technical Notes\n- Depends on: Google provider in NextAuth\n- Location: lib/services/GoogleDriveService.ts\n- Use Google APIs Node.js client library\n- Handle rate limiting gracefully\n\n**Reference:** TASKS/Phase3/3d-GoogleDrive/Spec.md § 3.2","status":"open","priority":1,"issue_type":"task","assignee":"cburr","created_at":"2026-01-13T14:49:00.586165Z","created_by":"cburr","updated_at":"2026-01-13T14:49:00.586165Z","labels":["data-portability","integration"],"dependencies":[{"issue_id":"AssurancePlatform-aeb.4.3","depends_on_id":"AssurancePlatform-aeb.4","type":"parent-child","created_at":"2026-01-13T14:49:00.595737Z","created_by":"cburr"},{"issue_id":"AssurancePlatform-aeb.4.3","depends_on_id":"AssurancePlatform-aeb.4.4","type":"blocks","created_at":"2026-01-13T14:54:21.64313Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-aeb.4.4","title":"Add Google provider to NextAuth","description":"Configure NextAuth to support Google OAuth authentication.\n\n## Requirements\n- Add GoogleProvider to NextAuth config\n- Configure scopes for Drive access\n- Handle token storage for API access\n- Support both sign-in and account linking\n- Store client credentials in environment\n\n## NextAuth Configuration\n- Use GoogleProvider with required scopes\n- Scopes: openid, email, profile, drive.file\n\n## Technical Notes\n- Depends on: Google Cloud Console setup\n- Location: lib/auth.ts or app/api/auth/[...nextauth]/route.ts\n- Ensure tokens are accessible for Drive API calls\n\n**Reference:** TASKS/Phase3/3d-GoogleDrive/Spec.md § 3.1","status":"open","priority":1,"issue_type":"task","assignee":"cburr","created_at":"2026-01-13T14:49:10.952318Z","created_by":"cburr","updated_at":"2026-01-13T14:49:10.952318Z","labels":["auth","data-portability","integration"],"dependencies":[{"issue_id":"AssurancePlatform-aeb.4.4","depends_on_id":"AssurancePlatform-aeb.4","type":"parent-child","created_at":"2026-01-13T14:49:10.96302Z","created_by":"cburr"},{"issue_id":"AssurancePlatform-aeb.4.4","depends_on_id":"AssurancePlatform-aeb.4.1","type":"blocks","created_at":"2026-01-13T14:54:21.373395Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-aeb.4.5","title":"Implement backup to Drive functionality","description":"Implement the \"Backup to Drive\" feature for assurance cases.\n\n## Flow\n1. User clicks \"Backup to Drive\"\n2. Export case as JSON (using 3a infrastructure)\n3. Upload to Google Drive via API\n4. Store Drive file ID in case metadata\n\n## Requirements\n- Backup button in case actions\n- Progress indicator during upload\n- Success confirmation with link to Drive\n- Store file ID for future updates\n- Handle existing backups (update vs create new)\n\n## Technical Notes\n- Depends on: Google Drive service, JSON export (3a)\n- Location: actions/ and components/\n\n**Reference:** TASKS/Phase3/3d-GoogleDrive/Spec.md § 3.2","status":"open","priority":1,"issue_type":"task","assignee":"cburr","created_at":"2026-01-13T14:49:34.612494Z","created_by":"cburr","updated_at":"2026-01-13T14:49:34.612494Z","labels":["data-portability","integration"],"dependencies":[{"issue_id":"AssurancePlatform-aeb.4.5","depends_on_id":"AssurancePlatform-aeb.4","type":"parent-child","created_at":"2026-01-13T14:49:34.62239Z","created_by":"cburr"},{"issue_id":"AssurancePlatform-aeb.4.5","depends_on_id":"AssurancePlatform-aeb.4.3","type":"blocks","created_at":"2026-01-13T14:54:21.773321Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-aeb.4.6","title":"Add Drive file picker integration","description":"Integrate Google Drive Picker API for file selection.\n\n## Requirements\n- Load Google Picker API\n- Configure picker for JSON files\n- Show picker modal in app context\n- Return selected file metadata\n- Handle picker cancellation\n\n## Technical Notes\n- Depends on: Google Drive service\n- Use Google Picker API\n- Consider accessibility\n- Location: lib/services/GooglePicker.ts\n\n**Reference:** TASKS/Phase3/3d-GoogleDrive/Spec.md § 3.2","status":"open","priority":2,"issue_type":"task","assignee":"cburr","created_at":"2026-01-13T14:49:38.486836Z","created_by":"cburr","updated_at":"2026-01-13T14:49:38.486836Z","labels":["data-portability","frontend","integration"],"dependencies":[{"issue_id":"AssurancePlatform-aeb.4.6","depends_on_id":"AssurancePlatform-aeb.4","type":"parent-child","created_at":"2026-01-13T14:49:38.48762Z","created_by":"cburr"},{"issue_id":"AssurancePlatform-aeb.4.6","depends_on_id":"AssurancePlatform-aeb.4.3","type":"blocks","created_at":"2026-01-13T14:54:21.900825Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-aeb.4.7","title":"Handle token refresh for Google integration","description":"Implement proper token refresh handling for Google API access.\n\n## Requirements\n- Detect expired tokens before API calls\n- Implement token refresh flow\n- Handle refresh failures gracefully\n- Re-authenticate if refresh fails\n- Store refreshed tokens\n\n## Technical Notes\n- Depends on: Google provider in NextAuth\n- Google access tokens expire after 1 hour\n- Use refresh tokens for seamless experience\n- Consider background refresh\n\n**Reference:** TASKS/Phase3/3d-GoogleDrive/Spec.md § 4","status":"open","priority":2,"issue_type":"task","assignee":"cburr","created_at":"2026-01-13T14:49:40.153443Z","created_by":"cburr","updated_at":"2026-01-13T14:49:40.153443Z","labels":["auth","data-portability","integration"],"dependencies":[{"issue_id":"AssurancePlatform-aeb.4.7","depends_on_id":"AssurancePlatform-aeb.4","type":"parent-child","created_at":"2026-01-13T14:49:40.159421Z","created_by":"cburr"},{"issue_id":"AssurancePlatform-aeb.4.7","depends_on_id":"AssurancePlatform-aeb.4.3","type":"blocks","created_at":"2026-01-13T14:54:22.02461Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-aeb.4.8","title":"Implement import from Drive functionality","description":"Implement the \"Import from Drive\" feature for assurance cases.\n\n## Flow\n1. User clicks \"Import from Drive\"\n2. Show Google Drive Picker\n3. User selects JSON file\n4. Download selected file\n5. Import using 3a infrastructure\n\n## Requirements\n- Import button in dashboard/import page\n- Integration with Drive file picker\n- Validate selected file is JSON\n- Preview before import\n- Error handling for invalid files\n\n## Technical Notes\n- Depends on: Google Drive service, JSON import (3a), File picker\n- Location: actions/ and components/\n\n**Reference:** TASKS/Phase3/3d-GoogleDrive/Spec.md § 3.2","status":"open","priority":1,"issue_type":"task","assignee":"cburr","created_at":"2026-01-13T14:49:50.58303Z","created_by":"cburr","updated_at":"2026-01-13T14:49:50.58303Z","labels":["data-portability","integration"],"dependencies":[{"issue_id":"AssurancePlatform-aeb.4.8","depends_on_id":"AssurancePlatform-aeb.4","type":"parent-child","created_at":"2026-01-13T14:49:50.592524Z","created_by":"cburr"},{"issue_id":"AssurancePlatform-aeb.4.8","depends_on_id":"AssurancePlatform-aeb.4.3","type":"blocks","created_at":"2026-01-13T14:54:22.199862Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-aeb.5","title":"3e: GitHub Repository Sync","description":"# Phase 3e: GitHub Repository Sync\n\nCreate a GitHub App for deeper integration than OAuth alone provides. This enables features like repository webhooks, automated commits, and PR integration.\n\n## Key Features\n- GitHub App registration and configuration\n- Repository installation flow\n- Webhook handling\n- Automated commits for case changes\n- PR comments for case reviews\n\n## Acceptance Criteria\n- [ ] GitHub App can be installed on repositories\n- [ ] Cases can be linked to repositories\n- [ ] Changes auto-commit to linked repos\n- [ ] PR comments show case status\n- [ ] Uninstallation cleanly removes links\n\n**Reference:** TASKS/Phase3/3e-GitHubSync/Spec.md","status":"open","priority":4,"issue_type":"task","assignee":"cburr","created_at":"2026-01-13T14:50:10.901725Z","created_by":"cburr","updated_at":"2026-01-13T14:50:10.901725Z","labels":["data-portability","github","integration"],"dependencies":[{"issue_id":"AssurancePlatform-aeb.5","depends_on_id":"AssurancePlatform-aeb","type":"parent-child","created_at":"2026-01-13T14:50:10.911741Z","created_by":"cburr"},{"issue_id":"AssurancePlatform-aeb.5","depends_on_id":"AssurancePlatform-aeb.1","type":"blocks","created_at":"2026-01-13T14:53:29.449987Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-aeb.5.1","title":"Register GitHub App","description":"Register and configure a GitHub App for the TEA Platform.\n\n## App Permissions Required\n- Contents: Read \u0026 Write (for commits)\n- Pull requests: Read \u0026 Write (for comments)\n- Webhooks: Push events\n\n## Configuration\n- Callback URL for OAuth\n- Webhook URL for events\n- Installation URL\n- App logo and description\n\n## Technical Notes\n- Foundation for all GitHub App features\n- Document setup steps\n- Store app credentials securely\n\n**Reference:** TASKS/Phase3/3e-GitHubSync/Spec.md § 3.1, 3.2","status":"open","priority":4,"issue_type":"task","assignee":"cburr","created_at":"2026-01-13T14:50:34.287379Z","created_by":"cburr","updated_at":"2026-01-13T14:50:34.287379Z","labels":["data-portability","github","integration"],"dependencies":[{"issue_id":"AssurancePlatform-aeb.5.1","depends_on_id":"AssurancePlatform-aeb.5","type":"parent-child","created_at":"2026-01-13T14:50:34.29734Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-aeb.5.2","title":"Implement app installation flow","description":"Implement the GitHub App installation flow for users.\n\n## Requirements\n- \"Install App\" button in settings\n- Redirect to GitHub installation page\n- Handle installation callback\n- Store installation ID per user/org\n- Handle installation updates\n\n## Technical Notes\n- Depends on: GitHub App registration\n- Location: app/api/github/install/\n- Consider org vs personal installations\n\n**Reference:** TASKS/Phase3/3e-GitHubSync/Spec.md § 3","status":"open","priority":4,"issue_type":"task","assignee":"cburr","created_at":"2026-01-13T14:50:36.754206Z","created_by":"cburr","updated_at":"2026-01-13T14:50:36.754206Z","labels":["data-portability","github","integration"],"dependencies":[{"issue_id":"AssurancePlatform-aeb.5.2","depends_on_id":"AssurancePlatform-aeb.5","type":"parent-child","created_at":"2026-01-13T14:50:36.764194Z","created_by":"cburr"},{"issue_id":"AssurancePlatform-aeb.5.2","depends_on_id":"AssurancePlatform-aeb.5.1","type":"blocks","created_at":"2026-01-13T14:54:23.489651Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-aeb.5.3","title":"Create webhook handler endpoints","description":"Create API endpoints to handle GitHub App webhooks.\n\n## Webhook Events to Handle\n- installation: App installed/uninstalled\n- push: Repository commits\n- pull_request: PR opened/updated/merged\n\n## Requirements\n- Verify webhook signatures\n- Parse event payloads\n- Trigger appropriate actions\n- Error handling and logging\n\n## Technical Notes\n- Depends on: GitHub App registration\n- Location: app/api/github/webhook/\n- Use GitHub's webhook libraries for verification\n\n**Reference:** TASKS/Phase3/3e-GitHubSync/Spec.md § 3","status":"open","priority":4,"issue_type":"task","assignee":"cburr","created_at":"2026-01-13T14:50:38.203338Z","created_by":"cburr","updated_at":"2026-01-13T14:50:38.203338Z","labels":["api","data-portability","github","integration"],"dependencies":[{"issue_id":"AssurancePlatform-aeb.5.3","depends_on_id":"AssurancePlatform-aeb.5","type":"parent-child","created_at":"2026-01-13T14:50:38.211786Z","created_by":"cburr"},{"issue_id":"AssurancePlatform-aeb.5.3","depends_on_id":"AssurancePlatform-aeb.5.2","type":"blocks","created_at":"2026-01-13T14:54:23.637271Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-aeb.5.4","title":"Implement repository linking UI","description":"Create UI for linking assurance cases to GitHub repositories.\n\n## Requirements\n- Link repository option in case settings\n- Repository selector (from installed repos)\n- Display linked repository info\n- Unlink option\n- Show sync status\n\n## Technical Notes\n- Depends on: Installation flow, webhook handlers\n- Location: components/cases/RepositoryLink.tsx\n\n**Reference:** TASKS/Phase3/3e-GitHubSync/Spec.md § 3.3","status":"open","priority":4,"issue_type":"task","assignee":"cburr","created_at":"2026-01-13T14:50:40.049512Z","created_by":"cburr","updated_at":"2026-01-13T14:50:40.049512Z","labels":["data-portability","frontend","github","integration"],"dependencies":[{"issue_id":"AssurancePlatform-aeb.5.4","depends_on_id":"AssurancePlatform-aeb.5","type":"parent-child","created_at":"2026-01-13T14:50:40.05955Z","created_by":"cburr"},{"issue_id":"AssurancePlatform-aeb.5.4","depends_on_id":"AssurancePlatform-aeb.5.3","type":"blocks","created_at":"2026-01-13T14:54:23.801547Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-aeb.5.5","title":"Build auto-commit functionality","description":"Implement automatic commits of case changes to linked repositories.\n\n## Requirements\n- Detect case changes (create, update, delete elements)\n- Export case as JSON\n- Commit to repository .tea/ folder\n- Configurable commit messages\n- Handle merge conflicts\n\n## Technical Notes\n- Depends on: Repository linking, JSON export (3a)\n- Use GitHub API for commits\n- Consider batching rapid changes\n\n**Reference:** TASKS/Phase3/3e-GitHubSync/Spec.md § 3.3","status":"open","priority":4,"issue_type":"task","assignee":"cburr","created_at":"2026-01-13T14:50:56.77198Z","created_by":"cburr","updated_at":"2026-01-13T14:50:56.77198Z","labels":["data-portability","github","integration"],"dependencies":[{"issue_id":"AssurancePlatform-aeb.5.5","depends_on_id":"AssurancePlatform-aeb.5","type":"parent-child","created_at":"2026-01-13T14:50:56.783455Z","created_by":"cburr"},{"issue_id":"AssurancePlatform-aeb.5.5","depends_on_id":"AssurancePlatform-aeb.5.3","type":"blocks","created_at":"2026-01-13T14:54:23.937462Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-aeb.5.6","title":"Add PR comment integration","description":"Implement PR comment integration for linked repositories.\n\n## Requirements\n- Comment on PRs with case status\n- Link evidence to PR reviews\n- Case diff visualisation in comments\n- Update comments when case changes\n\n## Technical Notes\n- Depends on: Webhook handlers, repository linking\n- Use GitHub API for PR comments\n- Consider comment formatting (Markdown)\n\n**Reference:** TASKS/Phase3/3e-GitHubSync/Spec.md § 3.3","status":"open","priority":4,"issue_type":"task","assignee":"cburr","created_at":"2026-01-13T14:50:59.514875Z","created_by":"cburr","updated_at":"2026-01-13T14:50:59.514875Z","labels":["data-portability","github","integration"],"dependencies":[{"issue_id":"AssurancePlatform-aeb.5.6","depends_on_id":"AssurancePlatform-aeb.5","type":"parent-child","created_at":"2026-01-13T14:50:59.525045Z","created_by":"cburr"},{"issue_id":"AssurancePlatform-aeb.5.6","depends_on_id":"AssurancePlatform-aeb.5.3","type":"blocks","created_at":"2026-01-13T14:54:24.064431Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-aeb.5.7","title":"Handle app uninstallation","description":"Handle GitHub App uninstallation gracefully.\n\n## Requirements\n- Process uninstall webhook event\n- Remove installation records\n- Update linked cases (mark as unlinked)\n- Notify users of uninstallation\n- Clean up any pending sync operations\n\n## Technical Notes\n- Depends on: Webhook handlers\n- Ensure no orphaned data\n- Consider data retention policy\n\n**Reference:** TASKS/Phase3/3e-GitHubSync/Spec.md § 5","status":"open","priority":4,"issue_type":"task","assignee":"cburr","created_at":"2026-01-13T14:51:01.129706Z","created_by":"cburr","updated_at":"2026-01-13T14:51:01.129706Z","labels":["data-portability","github","integration"],"dependencies":[{"issue_id":"AssurancePlatform-aeb.5.7","depends_on_id":"AssurancePlatform-aeb.5","type":"parent-child","created_at":"2026-01-13T14:51:01.138133Z","created_by":"cburr"},{"issue_id":"AssurancePlatform-aeb.5.7","depends_on_id":"AssurancePlatform-aeb.5.3","type":"blocks","created_at":"2026-01-13T14:54:24.246591Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-aeb.6","title":"3f: Recycle Bin (Soft Delete)","description":"# Phase 3f: Recycle Bin (Soft Delete)\n\nImplement a soft-delete system where deleted cases are moved to a recycle bin instead of being permanently deleted. Cases in the recycle bin are automatically purged after 30 days.\n\n## User Story\n\u003e As an End User, I want a feature where cases I delete are moved to a trash or recycle bin temporarily before being permanently deleted, so that I can recover cases if I accidentally delete them, preventing loss of important data.\n\n## Acceptance Criteria\n- [ ] Deleted cases appear in a \"Trash\" or \"Recycle Bin\" section\n- [ ] Cases in trash are automatically permanently deleted after 30 days\n- [ ] Users can restore cases from trash during the retention period\n- [ ] Users can permanently delete cases immediately from trash (optional)\n- [ ] Trash section shows deletion date and days remaining\n\n**Reference:** TASKS/Phase3/3f-RecycleBin/Spec.md","status":"open","priority":2,"issue_type":"task","assignee":"cburr","created_at":"2026-01-13T14:51:24.596908Z","created_by":"cburr","updated_at":"2026-01-13T14:51:24.596908Z","labels":["data-integrity","data-portability"],"dependencies":[{"issue_id":"AssurancePlatform-aeb.6","depends_on_id":"AssurancePlatform-aeb","type":"parent-child","created_at":"2026-01-13T14:51:24.614808Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-aeb.6.1","title":"Add deletedAt and deletedBy fields to Prisma schema","description":"Add soft-delete fields to the AssuranceCase Prisma model.\n\n## Schema Changes\n\\`\\`\\`prisma\nmodel AssuranceCase {\n  // ... existing fields\n  deletedAt   DateTime?  // null = not deleted, set = soft deleted\n  deletedBy   String?    // user who deleted\n}\n\\`\\`\\`\n\n## Requirements\n- Create Prisma migration\n- Update TypeScript types\n- Test migration on existing data\n\n## Technical Notes\n- Foundation for all soft-delete functionality\n- Location: prisma/schema.prisma\n\n**Reference:** TASKS/Phase3/3f-RecycleBin/Spec.md § 4.1","status":"open","priority":2,"issue_type":"task","assignee":"cburr","created_at":"2026-01-13T14:51:54.843067Z","created_by":"cburr","updated_at":"2026-01-13T14:51:54.843067Z","labels":["data-integrity","data-portability","schema"],"dependencies":[{"issue_id":"AssurancePlatform-aeb.6.1","depends_on_id":"AssurancePlatform-aeb.6","type":"parent-child","created_at":"2026-01-13T14:51:54.849492Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-aeb.6.10","title":"Add confirmation dialog for permanent deletion","description":"Add confirmation dialogs for permanent deletion actions.\n\n## Requirements\n- Confirmation before purging individual case\n- Confirmation before emptying trash\n- Clear warning about irreversibility\n- Require typing case name for extra safety (optional)\n\n## Technical Notes\n- Enhancement to Trash page UI\n- Use shadcn/ui AlertDialog\n- Consider accessibility\n\n**Reference:** TASKS/Phase3/3f-RecycleBin/Spec.md § 4.4","status":"open","priority":3,"issue_type":"task","assignee":"cburr","created_at":"2026-01-13T14:52:36.905899Z","created_by":"cburr","updated_at":"2026-01-13T14:52:36.905899Z","labels":["data-integrity","data-portability","frontend"],"dependencies":[{"issue_id":"AssurancePlatform-aeb.6.10","depends_on_id":"AssurancePlatform-aeb.6","type":"parent-child","created_at":"2026-01-13T14:52:36.918858Z","created_by":"cburr"},{"issue_id":"AssurancePlatform-aeb.6.10","depends_on_id":"AssurancePlatform-aeb.6.7","type":"blocks","created_at":"2026-01-13T14:54:27.365453Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-aeb.6.2","title":"Update delete action to soft-delete","description":"Modify the existing delete case action to perform soft-delete.\n\n## Requirements\n- Change DELETE to set deletedAt timestamp\n- Record deletedBy user ID\n- Update response to indicate soft-delete\n- Maintain backwards compatibility\n\n## Technical Notes\n- Depends on: Prisma schema changes\n- Location: actions/cases.ts or app/api/cases/[id]/route.ts\n\n**Reference:** TASKS/Phase3/3f-RecycleBin/Spec.md § 4.2","status":"open","priority":2,"issue_type":"task","assignee":"cburr","created_at":"2026-01-13T14:51:56.429716Z","created_by":"cburr","updated_at":"2026-01-13T14:51:56.429716Z","labels":["data-integrity","data-portability"],"dependencies":[{"issue_id":"AssurancePlatform-aeb.6.2","depends_on_id":"AssurancePlatform-aeb.6","type":"parent-child","created_at":"2026-01-13T14:51:56.436244Z","created_by":"cburr"},{"issue_id":"AssurancePlatform-aeb.6.2","depends_on_id":"AssurancePlatform-aeb.6.1","type":"blocks","created_at":"2026-01-13T14:54:25.864573Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-aeb.6.3","title":"Create trash listing API endpoint","description":"Create API endpoint to list deleted cases for the current user.\n\n## Endpoint\nGET /api/cases/trash\n\n## Response\n- List of soft-deleted cases\n- Include: id, name, deletedAt, deletedBy, daysRemaining\n- Paginated if needed\n\n## Requirements\n- Filter by current user's cases only\n- Order by deletedAt descending\n- Calculate days remaining until purge\n\n## Technical Notes\n- Depends on: Prisma schema changes\n- Location: app/api/cases/trash/route.ts\n\n**Reference:** TASKS/Phase3/3f-RecycleBin/Spec.md § 4.2","status":"open","priority":2,"issue_type":"task","assignee":"cburr","created_at":"2026-01-13T14:51:57.821559Z","created_by":"cburr","updated_at":"2026-01-13T14:51:57.821559Z","labels":["api","data-integrity","data-portability"],"dependencies":[{"issue_id":"AssurancePlatform-aeb.6.3","depends_on_id":"AssurancePlatform-aeb.6","type":"parent-child","created_at":"2026-01-13T14:51:57.831006Z","created_by":"cburr"},{"issue_id":"AssurancePlatform-aeb.6.3","depends_on_id":"AssurancePlatform-aeb.6.1","type":"blocks","created_at":"2026-01-13T14:54:25.998058Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-aeb.6.4","title":"Create restore API endpoint","description":"Create API endpoint to restore a deleted case from trash.\n\n## Endpoint\nPOST /api/cases/[id]/restore\n\n## Requirements\n- Verify case is soft-deleted\n- Verify ownership\n- Clear deletedAt and deletedBy fields\n- Return restored case\n\n## Technical Notes\n- Depends on: Prisma schema changes\n- Location: app/api/cases/[id]/restore/route.ts\n\n**Reference:** TASKS/Phase3/3f-RecycleBin/Spec.md § 4.2","status":"open","priority":2,"issue_type":"task","assignee":"cburr","created_at":"2026-01-13T14:51:59.26855Z","created_by":"cburr","updated_at":"2026-01-13T14:51:59.26855Z","labels":["api","data-integrity","data-portability"],"dependencies":[{"issue_id":"AssurancePlatform-aeb.6.4","depends_on_id":"AssurancePlatform-aeb.6","type":"parent-child","created_at":"2026-01-13T14:51:59.277086Z","created_by":"cburr"},{"issue_id":"AssurancePlatform-aeb.6.4","depends_on_id":"AssurancePlatform-aeb.6.1","type":"blocks","created_at":"2026-01-13T14:54:26.129388Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-aeb.6.5","title":"Create permanent delete API endpoint","description":"Create API endpoint to permanently delete a case from trash.\n\n## Endpoint\nDELETE /api/cases/[id]/purge\n\n## Requirements\n- Verify case is soft-deleted\n- Verify ownership\n- Permanently delete case and all related data\n- Cascade delete: elements, comments, etc.\n- No recovery after purge\n\n## Security Considerations\n- Require confirmation\n- Consider rate limiting\n- Audit log for purge actions\n\n## Technical Notes\n- Depends on: Prisma schema changes\n- Location: app/api/cases/[id]/purge/route.ts\n\n**Reference:** TASKS/Phase3/3f-RecycleBin/Spec.md § 4.2","status":"open","priority":2,"issue_type":"task","assignee":"cburr","created_at":"2026-01-13T14:52:01.540573Z","created_by":"cburr","updated_at":"2026-01-13T14:52:01.540573Z","labels":["api","data-integrity","data-portability"],"dependencies":[{"issue_id":"AssurancePlatform-aeb.6.5","depends_on_id":"AssurancePlatform-aeb.6","type":"parent-child","created_at":"2026-01-13T14:52:01.548647Z","created_by":"cburr"},{"issue_id":"AssurancePlatform-aeb.6.5","depends_on_id":"AssurancePlatform-aeb.6.1","type":"blocks","created_at":"2026-01-13T14:54:26.29101Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-aeb.6.6","title":"Implement background purge job","description":"Implement a scheduled job to permanently delete cases older than 30 days.\n\n## Requirements\n- Run periodically (daily recommended)\n- Find cases where deletedAt \u003c now() - 30 days\n- Permanently delete matching cases\n- Log purge operations\n- Handle errors gracefully\n\n## Implementation Options\n- Azure Functions timer trigger\n- Vercel Cron Jobs\n- Database-level scheduled task\n\n## Technical Notes\n- Depends on: Prisma schema changes\n- Consider batch deletion for large volumes\n- Add monitoring/alerting\n\n**Reference:** TASKS/Phase3/3f-RecycleBin/Spec.md § 4.3","status":"open","priority":2,"issue_type":"task","assignee":"cburr","created_at":"2026-01-13T14:52:29.400827Z","created_by":"cburr","updated_at":"2026-01-13T14:52:29.400827Z","labels":["data-integrity","data-portability"],"dependencies":[{"issue_id":"AssurancePlatform-aeb.6.6","depends_on_id":"AssurancePlatform-aeb.6","type":"parent-child","created_at":"2026-01-13T14:52:29.411518Z","created_by":"cburr"},{"issue_id":"AssurancePlatform-aeb.6.6","depends_on_id":"AssurancePlatform-aeb.6.1","type":"blocks","created_at":"2026-01-13T14:54:26.469062Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-aeb.6.7","title":"Create Trash page UI","description":"Create the Trash/Recycle Bin page in the dashboard.\n\n## Location\n/dashboard/trash\n\n## Requirements\n- List deleted cases with:\n  - Case name\n  - Deletion date\n  - Days remaining until purge\n  - Deleted by\n- Restore button per item\n- Purge button per item (optional)\n- Empty Trash button\n- Empty state when no deleted cases\n- Responsive design\n\n## Technical Notes\n- Depends on: Trash listing, restore, purge endpoints\n- Location: app/(main)/dashboard/trash/page.tsx\n- Use shadcn/ui components\n\n**Reference:** TASKS/Phase3/3f-RecycleBin/Spec.md § 4.4","status":"open","priority":2,"issue_type":"task","assignee":"cburr","created_at":"2026-01-13T14:52:31.286697Z","created_by":"cburr","updated_at":"2026-01-13T14:52:31.286697Z","labels":["data-integrity","data-portability","frontend"],"dependencies":[{"issue_id":"AssurancePlatform-aeb.6.7","depends_on_id":"AssurancePlatform-aeb.6","type":"parent-child","created_at":"2026-01-13T14:52:31.294661Z","created_by":"cburr"},{"issue_id":"AssurancePlatform-aeb.6.7","depends_on_id":"AssurancePlatform-aeb.6.3","type":"blocks","created_at":"2026-01-13T14:54:26.762287Z","created_by":"cburr"},{"issue_id":"AssurancePlatform-aeb.6.7","depends_on_id":"AssurancePlatform-aeb.6.4","type":"blocks","created_at":"2026-01-13T14:54:26.922983Z","created_by":"cburr"},{"issue_id":"AssurancePlatform-aeb.6.7","depends_on_id":"AssurancePlatform-aeb.6.5","type":"blocks","created_at":"2026-01-13T14:54:27.064458Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-aeb.6.8","title":"Add trash link to sidebar navigation","description":"Add a Trash/Recycle Bin link to the dashboard sidebar.\n\n## Requirements\n- Add \"Trash\" item to sidebar navigation\n- Trash icon\n- Badge showing count of items in trash (optional)\n- Consistent with existing sidebar style\n\n## Technical Notes\n- Depends on: Trash page\n- Location: components/layout/Sidebar.tsx or similar\n\n**Reference:** TASKS/Phase3/3f-RecycleBin/Spec.md § 4.4","status":"open","priority":2,"issue_type":"task","assignee":"cburr","created_at":"2026-01-13T14:52:32.990771Z","created_by":"cburr","updated_at":"2026-01-13T14:52:32.990771Z","labels":["data-integrity","data-portability","frontend"],"dependencies":[{"issue_id":"AssurancePlatform-aeb.6.8","depends_on_id":"AssurancePlatform-aeb.6","type":"parent-child","created_at":"2026-01-13T14:52:32.999362Z","created_by":"cburr"},{"issue_id":"AssurancePlatform-aeb.6.8","depends_on_id":"AssurancePlatform-aeb.6.7","type":"blocks","created_at":"2026-01-13T14:54:27.24076Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-aeb.6.9","title":"Filter soft-deleted cases from normal listings","description":"Update all case listing queries to exclude soft-deleted cases.\n\n## Queries to Update\n- Dashboard case list\n- Team case list\n- Case search\n- Any API that returns case lists\n\n## Requirements\n- Add WHERE deletedAt IS NULL to all relevant queries\n- Ensure soft-deleted cases are not accessible via direct URL\n- Update TypeScript types if needed\n\n## Security Considerations\n- Verify soft-deleted cases cannot be accessed\n- Test all access paths\n\n## Technical Notes\n- Depends on: Delete action update\n- May use Prisma middleware for consistency\n\n**Reference:** TASKS/Phase3/3f-RecycleBin/Spec.md § 6","status":"open","priority":2,"issue_type":"task","assignee":"cburr","created_at":"2026-01-13T14:52:35.246178Z","created_by":"cburr","updated_at":"2026-01-13T14:52:35.246178Z","labels":["data-integrity","data-portability"],"dependencies":[{"issue_id":"AssurancePlatform-aeb.6.9","depends_on_id":"AssurancePlatform-aeb.6","type":"parent-child","created_at":"2026-01-13T14:52:35.264359Z","created_by":"cburr"},{"issue_id":"AssurancePlatform-aeb.6.9","depends_on_id":"AssurancePlatform-aeb.6.2","type":"blocks","created_at":"2026-01-13T14:54:26.637249Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-aip","title":"Test deletion confirmation","status":"tombstone","priority":4,"issue_type":"task","created_at":"2026-01-09T09:45:44.387603Z","created_by":"cburr","updated_at":"2026-01-09T09:46:01.870294Z","deleted_at":"2026-01-09T09:46:01.870294Z","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"AssurancePlatform-aky","title":"Update TASKS/Phase5 spec files","description":"Update all Phase 5 spec files to reflect the new testing philosophy:\n\n## Files to Update\n- TASKS/Phase5/Phase5-Tracker.md\n- TASKS/Phase5/5a-TestInfrastructure/Spec.md\n- TASKS/Phase5/5b-UnitTests/Spec.md\n- TASKS/Phase5/5c-IntegrationTests/Spec.md\n- TASKS/Phase5/5d-E2ETests/Spec.md\n\n## Key Changes\n- Remove Prisma mocking recommendations\n- Add testing trophy philosophy\n- Add real database testing approach\n- Update critical user journeys list\n- Reference new testing skill","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-15T12:32:15.906561Z","created_by":"cburr","updated_at":"2026-01-15T12:41:46.410624Z","closed_at":"2026-01-15T12:41:46.410624Z","close_reason":"Updated all TASKS/Phase5 spec files to reflect new testing philosophy (testing trophy, real DB, no Prisma mocking)","dependencies":[{"issue_id":"AssurancePlatform-aky","depends_on_id":"AssurancePlatform-ujm","type":"blocks","created_at":"2026-01-15T12:32:23.81472Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-aq9","title":"Reorganise share/export/permissions modals","description":"Consolidate three modals (Share, Export, Permissions) into two cleaner modals:\n\n**Current state:**\n- Share button → 'Share Case' modal (share by email/team, permissions)\n- Export button → 'Share / Export Case' modal (MIXED: sharing + export)\n- Permissions button → 'Permissions' modal (read-only access list)\n\n**Problems:**\n- Export modal has sharing functionality that doesn't belong\n- Two places to share (confusing UX)\n- Permissions modal is read-only but sharing is done elsewhere\n\n**Proposed solution:**\n1. **Share button** → 'Share \u0026 Permissions' modal\n   - Share by Email / Share with Team tabs\n   - Manage existing permissions (edit/remove access)\n   - View people with access\n\n2. **Export button** → 'Export Case' modal (pure export)\n   - Export as JSON (with comments option)\n   - Export as Image (PNG/SVG, resolution)\n   - Export as PDF (new - from aeb.3)\n   - Export as Word (new - from aeb.3)\n   - Export as Markdown (new - from aeb.3)\n   - Backup to Google Drive\n\n**UI changes:**\n- Remove Permissions button from action bar\n- Update Export modal to remove sharing section\n- Merge Permissions functionality into Share modal\n\n**Files likely affected:**\n- components/cases/modals/share-modal.tsx\n- components/cases/modals/export-modal.tsx\n- components/cases/modals/permissions-modal.tsx\n- components/cases/case-action-bar.tsx","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-15T13:48:46.377885Z","created_by":"cburr","updated_at":"2026-01-15T13:48:46.377885Z","dependencies":[{"issue_id":"AssurancePlatform-aq9","depends_on_id":"AssurancePlatform-aeb.3","type":"parent-child","created_at":"2026-01-15T13:49:23.755578Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-at5","title":"Plan migration to rename legacy table names (api_*)","description":"Legacy table names from Django migration remain in the Prisma schema (e.g., api_casestudy, legacy_mappings).\n\nPlan and execute a migration to use cleaner table names.\n\nConsiderations:\n- Foreign key dependencies\n- Downtime requirements\n- Rollback strategy\n\nDeferred from Phase 2c.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-07T13:00:38.167572Z","created_by":"cburr","updated_at":"2026-01-09T15:47:05.822703Z","closed_at":"2026-01-09T15:47:05.822703Z","close_reason":"Renamed 4 legacy Django tables to clean conventions. Also added schema doc comments, DBML generator config, and removed unused locking feature.","labels":["tech-debt"],"dependencies":[{"issue_id":"AssurancePlatform-at5","depends_on_id":"AssurancePlatform-jdr","type":"blocks","created_at":"2026-01-09T09:37:13.728345Z","created_by":"cburr"},{"issue_id":"AssurancePlatform-at5","depends_on_id":"AssurancePlatform-dpk","type":"parent-child","created_at":"2026-01-09T09:38:48.835619Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-bdi","title":"Implement Published Cases feature","description":"The Published Cases functionality currently returns empty arrays marked 'Not yet implemented'.\n\nLocation: Various files returning published cases data\n\nThis feature should allow users to publish their assurance cases for public viewing.\n\nDeferred from Phase 2c.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T13:00:37.881351Z","created_by":"cburr","updated_at":"2026-01-08T10:55:18.068558Z","closed_at":"2026-01-08T10:55:18.068558Z","close_reason":"Feature implemented and tested","labels":["feature"]}
{"id":"AssurancePlatform-bp8","title":"Audit environment variables on Azure app services","description":"Comprehensive audit and documentation of all environment variables across the TEA Platform.\n\n## Scope (Expanded)\n\nThis issue now includes the database rename from cep (staging DB postgres to eap).\n\n### Discovery\n- All env vars referenced in application code\n- GitHub Actions workflow variables and secrets\n- Azure App Service configuration (staging + production)\n- Local development configuration\n\n### Categorisation\n- Required vs optional\n- Server-side vs client-side (NEXT_PUBLIC_*)\n- Secrets vs configuration\n- Per-environment (dev/staging/prod)\n\n### Risk Assessment\n- Impact of misconfiguration for each variable\n- Rollback strategies\n- Testing approach\n\n### Deliverables\n- Comprehensive documentation of all env vars\n- Updated example env file with descriptions\n- Identification of obsolete/legacy variables\n- Implementation plan for any changes (including DB rename)\n\n## Guiding Principle\n\nDo not break production. All changes must be carefully planned with rollback strategies.\n\nMerged from: AssurancePlatform-cep (staging database rename)\nDeferred from: Phase 2c Technical Cleanup","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-07T13:00:38.796593Z","created_by":"cburr","updated_at":"2026-01-13T13:41:06.632128Z","closed_at":"2026-01-13T13:41:06.632128Z","close_reason":"Completed environment variable audit and database user migration. Removed 13 legacy/unused variables from GitHub and Azure. Created dedicated tea_app database user (non-admin) for both staging and production. Renamed databases from eap to tea. Documentation updated in TASKS/database-user-migration.md.","labels":["devops"],"dependencies":[{"issue_id":"AssurancePlatform-bp8","depends_on_id":"AssurancePlatform-dpk","type":"parent-child","created_at":"2026-01-09T09:38:47.607619Z","created_by":"cburr"}],"comments":[{"id":2,"issue_id":"AssurancePlatform-bp8","author":"cburr","text":"Comprehensive audit plan drafted: TASKS/env-var-audit-plan.md. Includes complete variable inventory, risk assessment, phased implementation plan, and rollback procedures. Ready for implementation when prioritised.","created_at":"2026-01-09T16:03:32Z"}]}
{"id":"AssurancePlatform-bpf","title":"Implement transaction rollback test helpers","description":"Create test utilities for transaction-based test isolation.\n\n## Location\nsrc/__tests__/utils/db-test-utils.ts\n\n## API Design\n```typescript\n// Wrap each test in a transaction that rolls back\nexport async function withTestTransaction\u003cT\u003e(\n  fn: (tx: PrismaTransaction) =\u003e Promise\u003cT\u003e\n): Promise\u003cT\u003e\n\n// Setup/teardown for test suites\nexport async function setupTestDatabase(): Promise\u003cvoid\u003e\nexport async function teardownTestDatabase(): Promise\u003cvoid\u003e\n\n// Get test-scoped Prisma client\nexport function getTestPrisma(): PrismaClient\n```\n\n## Benefits\n- Tests are isolated (no cleanup needed)\n- Tests are fast (no actual commits)\n- Tests can run in parallel safely","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-15T12:32:59.188111Z","created_by":"cburr","updated_at":"2026-01-15T12:32:59.188111Z","dependencies":[{"issue_id":"AssurancePlatform-bpf","depends_on_id":"AssurancePlatform-x8n","type":"blocks","created_at":"2026-01-15T12:33:07.388162Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-c0l","title":"Phase 2c: Technical Cleanup","description":"Housekeeping tasks to consolidate dependencies, remove legacy code, and address technical debt.\n\nCompleted Tasks:\n- [x] Consolidate notifications: Remove react-toastify in favour of sonner\n- [x] Replace moment.js with date-fns\n- [x] Centralise public route definitions (lib/routes.ts)\n- [x] Delete eap-backend App Service (old Django backend)\n- [x] Delete frontend-test-resource (unused Azure Load Testing)\n- [x] Implement JWT-only auth with USE_JWT_ONLY_AUTH feature flag\n\nDeferred Tasks:\n- [ ] Implement Published Cases (returns empty arrays)\n- [ ] Plan migration to rename legacy table names (api_*)\n- [ ] Ensure all Server Actions use Zod validation\n- [ ] Audit all env vars on both app services\n- [ ] Rename staging database from postgres to eap\n\nLint Exclusions to Address:\n- components/ui/** (shadcn/ui patterns)\n- types/*.d.ts\n- app/api/cases/*/permissions/**\n- Various files with suppression comments","status":"tombstone","priority":1,"issue_type":"task","created_at":"2026-01-07T12:58:17.49846Z","created_by":"cburr","updated_at":"2026-01-07T13:00:21.430949Z","labels":["tech-debt"],"deleted_at":"2026-01-07T13:00:21.430949Z","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"AssurancePlatform-ceo","title":"Security: Address timing attack vulnerability in JWT callback","description":"The JWT callback in lib/auth-options.ts (lines 302-305) checks token expiry and clears expired tokens in a way that creates timing side-channel.\n\n**Issue:** Valid tokens complete the full callback execution path while expired tokens modify the token object then return. This creates measurable timing differences that could be exploited for session enumeration.\n\n**Impact:** An attacker could use timing attacks to determine if a session token has expired without having valid credentials.\n\n**Fix:** Move the expiry validation to a separate middleware or route guard with constant-time checks.\n\n**Confidence:** 85%","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-24T10:27:23.037717Z","updated_at":"2026-01-08T09:41:52.508262Z","closed_at":"2026-01-08T09:41:52.508262Z","close_reason":"Fixed timing attack vulnerability by implementing constant-time validation utilities and refactoring auth code to eliminate timing side-channels","labels":["auth","security"]}
{"id":"AssurancePlatform-cep","title":"Rename staging database from 'postgres' to 'eap'","description":"The staging database is named 'postgres' while production uses 'eap'. Rename for consistency.\n\nCurrent:\n- Production: eap-database-v15 / eap\n- Staging: staging-eap-database / postgres\n\nTarget:\n- Staging: staging-eap-database / eap\n\nDeferred from Phase 2c.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-07T13:00:39.111345Z","created_by":"cburr","updated_at":"2026-01-09T15:58:09.255811Z","closed_at":"2026-01-09T15:58:09.255811Z","close_reason":"Merged into bp8 - database rename will be part of comprehensive env var audit","labels":["devops"],"dependencies":[{"issue_id":"AssurancePlatform-cep","depends_on_id":"AssurancePlatform-dpk","type":"parent-child","created_at":"2026-01-09T09:38:45.975476Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-cos","title":"Update testing skill to be user-invocable","description":"Add the testing skill to the Skill tool's available skills list so it can be invoked with /testing.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-15T12:32:13.963996Z","created_by":"cburr","updated_at":"2026-01-15T12:32:13.963996Z","dependencies":[{"issue_id":"AssurancePlatform-cos","depends_on_id":"AssurancePlatform-ujm","type":"blocks","created_at":"2026-01-15T12:32:23.590576Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-cta","title":"Ensure all Server Actions use Zod validation","description":"Audit all Server Actions in actions/ directory and ensure they use Zod schemas for input validation.\n\nThis improves type safety and provides better error messages for invalid input.\n\nDeferred from Phase 2c.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T13:00:38.478085Z","created_by":"cburr","updated_at":"2026-01-08T16:14:38.769967Z","closed_at":"2026-01-08T16:14:38.769967Z","close_reason":"Implemented Zod validation for all Server Actions. Created schemas in lib/schemas/, validation helpers in lib/validation/server-action.ts, and ActionResult type. Updated actions/assurance-cases.ts, actions/case-studies.ts, and actions/capture.ts with Zod validation. Updated all callers to handle ActionResult. Deleted low-value capture.test.ts. Remaining test failures are pre-existing issues unrelated to this change.","labels":["code-quality"]}
{"id":"AssurancePlatform-cv8","title":"Write team collaboration E2E tests","description":"Write E2E tests for team collaboration.\n\n## Tests\n- Create team\n- Invite team member\n- Accept invitation\n- Change member role\n- Remove member\n- Share case with team\n\n## Assertions\n- Invitee receives access\n- Role changes take effect\n- Removed members lose access","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-15T12:34:26.798671Z","created_by":"cburr","updated_at":"2026-01-15T12:34:26.798671Z","dependencies":[{"issue_id":"AssurancePlatform-cv8","depends_on_id":"AssurancePlatform-8sk","type":"blocks","created_at":"2026-01-15T12:34:35.09437Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-d8t","title":"Close 22 GitHub issues covered by TASKS directory","description":"Close the 22 GitHub issues that are already tracked in the TASKS directory phases.\n\n## Reference\nSee TASKS/GitHub-Issues-Migration.md for:\n- Full list of issues to close (22 total)\n- Suggested close messages for each issue\n- CLI commands for bulk closing\n\n## Issues to Close\n### Originally Covered (15)\n#713, #654, #488, #687, #498, #490, #465, #464, #463, #426, #425, #645, #460, #458, #432\n\n### Previously Partially Covered (7)\n#665, #492, #686, #684, #689, #485, #652","acceptance_criteria":"- [ ] All 22 issues closed with appropriate comments\n- [ ] Each close message references the relevant TASKS phase","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-02T17:09:15.01986Z","created_by":"cburr","updated_at":"2026-01-07T13:45:10.480636Z","closed_at":"2026-01-07T13:45:10.480636Z","close_reason":"22 GitHub issues closed manually and remaining 15 migrated to TASKS phases or beads"}
{"id":"AssurancePlatform-dov","title":"Reset identifiers not updating element names","description":"## Problem\n\nThe 'Reset Identifiers' button in the action bar does not update element names in the database. After clicking the button and confirming, elements retain their original names (e.g., duplicate P1 labels or out-of-order numbering like P1, P3, P2 instead of P1, P2, P3).\n\n## Expected Behaviour\n\nClicking 'Reset Identifiers' should:\n1. Renumber all elements sequentially based on creation order\n2. Goals, Strategies, Evidence use case-wide sequential numbering (G1, S1, S2, E1, E2...)\n3. Top-level Property Claims (under Strategy/Goal) use case-wide sequential (P1, P2, P3...)\n4. Nested Property Claims use hierarchical dot notation (P1.1, P1.2, P1.1.1...)\n5. Changes should persist to the database\n\n## Affected Files\n\n- `app/api/cases/[id]/update-ids/route.ts` - API endpoint that performs the reset\n- `components/cases/action-buttons.tsx` - UI button that calls the API (lines 80-102)\n\n## Reproduction Steps\n\n1. Create a case with multiple property claims\n2. Delete some elements or reattach orphaned elements (causing non-sequential IDs)\n3. Click the 'Reset Identifiers' button (circular arrow icon in action bar)\n4. Confirm the reset\n5. Observe that element names are NOT updated\n\n## Technical Notes\n\nThe reset API at `/api/cases/[id]/update-ids`:\n- Builds a tree from elements ordered by createdAt\n- Traverses depth-first generating new names\n- Should update all elements via Prisma\n\nInvestigation needed to determine if:\n- The API is returning an error\n- The database updates are not being persisted\n- There's a logic error in the tree traversal/name generation","status":"closed","priority":0,"issue_type":"bug","created_at":"2026-01-11T08:20:48.050374Z","created_by":"cburr","updated_at":"2026-01-11T08:55:45.851702Z","closed_at":"2026-01-11T08:55:45.851702Z","close_reason":"Added SSE event emission to reset identifiers API. Fixed by not passing userId to emitSSEEvent() so the triggering user receives the event and UI updates in real-time."}
{"id":"AssurancePlatform-dpk","title":"Phase 2: Platform Stabilisation","description":"Epic for Phase 2 of the TEA Platform development roadmap. Focus: stabilising the deployed platform, improving developer experience, and cleaning up technical debt from the Django to Next.js migration.\n\nSub-phases:\n- 2a: DevOps \u0026 CI/CD\n- 2b: Documentation Migration  \n- 2b': Curriculum Module System\n- 2c: Technical Cleanup\n- 2d: Auth Cleanup\n\nExit Criteria:\n- CI/CD pipeline runs reliably without manual intervention\n- Documentation builds cleanly with Nextra\n- No duplicate dependencies in bundle\n- Legacy code removed or documented","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-07T12:57:48.508141Z","created_by":"cburr","updated_at":"2026-01-13T13:45:48.536013Z","closed_at":"2026-01-13T13:45:48.536013Z","close_reason":"All child issues completed. Environment variables cleaned up, database users migrated to dedicated non-admin accounts, databases renamed to tea."}
{"id":"AssurancePlatform-fxo","title":"Write case management E2E tests","description":"Write E2E tests for case management.\n\n## Tests\n- Create new case\n- Add goal to case\n- Add strategy to goal\n- Add evidence to strategy\n- Edit element properties\n- Delete element\n- Delete case\n\n## Assertions\n- Elements appear on canvas\n- Changes persist after refresh\n- Deletion removes from list","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-15T12:34:25.753289Z","created_by":"cburr","updated_at":"2026-01-15T12:34:25.753289Z","dependencies":[{"issue_id":"AssurancePlatform-fxo","depends_on_id":"AssurancePlatform-8sk","type":"blocks","created_at":"2026-01-15T12:34:34.91738Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-g2a","title":"Phase 5: Testing Infrastructure Overhaul","description":"Overhaul the testing infrastructure to follow the testing trophy pattern with real database testing.\n\n## Philosophy\n- Testing Trophy \u003e Pyramid (integration tests provide most value)\n- Never mock Prisma (use real test database)\n- Mock only external services (OAuth, Azure, Google Drive, GitHub API)\n- Hybrid approach: keep infrastructure, discard mock-heavy tests\n\n## Sub-Phases\n- 5a: Test Infrastructure Cleanup\n- 5b: Real Database Testing Setup\n- 5c: Integration Test Suite\n- 5d: Playwright E2E Setup\n- 5e: CI Integration\n\n## Critical User Journeys (E2E)\n1. Authentication (create account, sign in, sign out)\n2. Case Management (create, edit, delete)\n3. Collaboration (comments, sharing)\n4. Team Management (create team, members, permissions)\n5. Community Case Studies (publish, update)\n6. Documentation (access, curriculum, progress)\n7. User Settings (password, name, delete account)\n8. Import/Export (GitHub import, Google Drive backup)\n\n## Reference\n- Testing skill: .claude/skills/testing/SKILL.md\n- Plan: .claude/plans/synchronous-foraging-dewdrop.md","status":"open","priority":2,"issue_type":"epic","created_at":"2026-01-15T12:23:02.894142Z","created_by":"cburr","updated_at":"2026-01-15T12:23:02.894142Z","labels":["infrastructure","testing"]}
{"id":"AssurancePlatform-hdo","title":"Create page object models","description":"Create page object models for E2E tests.\n\n## Location\ntests/e2e/pages/\n\n## Page Objects\n- LoginPage (sign in form, OAuth buttons)\n- DashboardPage (case list, create button, navigation)\n- CaseEditorPage (canvas, element panel, toolbar)\n- TeamPage (member list, invite form)\n- SettingsPage (profile, security)\n\n## Pattern\n```typescript\nexport class LoginPage {\n  constructor(private page: Page) {}\n  \n  async goto() { await this.page.goto('/login') }\n  async signIn(email: string, password: string) { ... }\n  async signInWithGitHub() { ... }\n}\n```","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-15T12:34:23.093648Z","created_by":"cburr","updated_at":"2026-01-15T12:34:23.093648Z","dependencies":[{"issue_id":"AssurancePlatform-hdo","depends_on_id":"AssurancePlatform-8sk","type":"blocks","created_at":"2026-01-15T12:34:34.661981Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-i1h","title":"Fix broken links on Case Studies documentation page","description":"On the main Case Studies page (https://assuranceplatform.azurewebsites.net/docs/curriculum/hands-on/case-studies), the inline links to individual case studies are broken (404 errors).\n\n**Issue:**\n- Inline links point to: `/docs/curriculum/hands-on/diabetic-retinopathy-screening`\n- Correct path is: `/docs/curriculum/hands-on/case-studies/diabetic-retinopathy-screening`\n\nThe sidebar links work correctly, but the inline links in the main content are missing the `case-studies/` path segment.\n\n**Affected links:**\n- Diabetic Retinopathy Screening\n- Crop Damage Assessment\n- Flood Risk Assessment  \n- Student Learning Assessment\n\n**Fix:**\nUpdate the markdown links in the case-studies.mdx file to include the correct path.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-08T08:25:27.42476Z","created_by":"cburr","updated_at":"2026-01-08T13:08:36.785889Z","closed_at":"2026-01-08T13:08:36.785889Z","close_reason":"Fixed: Updated index page with enhanced layout including all 6 case studies with summary table. Created _meta.ts to hide individual case studies from sidebar - users now navigate via index page only."}
{"id":"AssurancePlatform-ih3","title":"Add Connected Accounts section to settings page","description":"Add a Connected Accounts section to the settings page that provides users with transparency and control over their linked authentication providers.\n\n## Features\n\n### View Linked Providers\n- Display which auth methods are connected (Local, GitHub, Google)\n- Show associated email for each provider\n- Show connection status (active, token expired, etc.)\n\n### Link New Provider\n- Button to connect GitHub or Google to existing account\n- Handle account linking flow with proper feedback\n\n### Unlink Provider\n- Remove a provider from the account\n- Safeguard: prevent unlinking if it's the only auth method\n- Require confirmation before unlinking\n\n### Google Drive Status\n- Show if Drive access is active\n- Display token expiry status\n- Option to revoke Drive-only access without unlinking Google login\n\n### GitHub Status\n- Show connected GitHub username\n- Display repository access status (for imports)\n\n### Primary Email (optional)\n- Allow user to choose which email to use for notifications if multiple providers linked\n\n### Last Sign-in Info (optional)\n- Show which provider was last used and when\n\n## Technical Notes\n- New component: `app/(main)/dashboard/settings/_components/connected-accounts.tsx`\n- May need new API route for unlinking: `DELETE /api/auth/providers/[provider]`\n- Query user's google/github fields from database to display status","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-14T07:13:32.186219Z","created_by":"cburr","updated_at":"2026-01-15T12:26:44.344707Z","closed_at":"2026-01-15T12:26:44.344707Z","close_reason":"Implemented connected accounts section with link/unlink functionality"}
{"id":"AssurancePlatform-iqi","title":"Test delete confirmation","status":"tombstone","priority":4,"issue_type":"task","created_at":"2026-01-09T09:47:34.039315Z","created_by":"cburr","updated_at":"2026-01-09T09:47:41.032367Z","deleted_at":"2026-01-09T09:47:41.032367Z","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"AssurancePlatform-jdr","title":"Remove 39 legacy Django tables from database","description":"## Overview\n\nAfter migrating from Django to Next.js/Prisma, 39 orphaned database tables remain. These tables have NO corresponding Prisma model (no @@map directive) and are therefore not used by the application.\n\n## Verification Performed\n\n1. Compared CREATE TABLE statements in prod backup against @@map directives in schema.prisma\n2. Agent search confirmed no raw SQL queries reference these tables\n3. No foreign key constraints exist between orphaned and active tables\n\n## Tables to Remove (39 total)\n\n### Django Auth/Admin (12 tables)\naccount_emailaddress, account_emailconfirmation, auth_group, auth_group_permissions, auth_permission, authtoken_token, django_admin_log, django_content_type, django_migrations, django_session, django_site\n\n### Social Auth (8 tables)\nsocial_auth_association, social_auth_code, social_auth_nonce, social_auth_partial, social_auth_usersocialauth, socialaccount_socialaccount, socialaccount_socialapp, socialaccount_socialapp_sites, socialaccount_socialtoken\n\n### Migrated API Tables (18 tables)\napi_assurancecase, api_assurancecase_edit_groups, api_assurancecase_review_groups, api_assurancecase_view_groups, api_assurancecaseimage, api_comment, api_context, api_eapgroup, api_eapgroup_member, api_eapuser, api_eapuser_groups, api_eapuser_user_permissions, api_evidence, api_evidence_property_claim, api_githubrepository, api_propertyclaim, api_strategy, api_toplevelnormativegoal\n\n### Other (1 table)\nwebsockets_assurancecaseconnection\n\n## Implementation Plan\n\n### Phase 1: Local Testing Setup\n- Restore prod backup to local dev database\n- Verify app works correctly with current state\n- Document baseline test results\n\n### Phase 2: Create Migration\n- Create manual migration file in prisma/migrations/\n- Write removal statements for all 39 tables\n- Order correctly (check for inter-table dependencies)\n\n### Phase 3: Local Verification\n- Apply migration to local database\n- Run Prisma generate to verify client still works\n- Check for any console errors on app startup\n\n### Phase 4: User Flow Testing\n- Auth: Login (credentials), Login (GitHub), Registration, Logout\n- Password: Reset request, Reset completion\n- Cases: Create, Edit, Delete, View\n- Publishing: Publish case, Unpublish case\n- Case Studies: View list, View detail, Create, Link published cases\n- Teams: Create team, Invite member, Remove member\n- Permissions: Share case, Change permissions\n- GitHub: Connect repo, View repos\n\n### Phase 5: Automated Tests\n- Run full test suite\n- Run E2E tests if available\n- All tests pass\n\n### Phase 6: Staging Deployment\n- Create PR with migration\n- Deploy to staging\n- Run smoke tests\n- Monitor logs for 24h\n\n### Phase 7: Production Deployment\n- Merge to main after staging verification\n- Deploy to production\n- Monitor for errors\n\n## Future Cleanup (Separate Issues)\n- legacy_mappings table (Prisma-managed but unused)\n- refresh_tokens table (Pending Phase 2d)\n- Rename api_casestudy tables to cleaner names\n\n## Reference\n- Prod backup: backups/prod-backup-20260107-163812-current.sql\n- Phase 2c spec: TASKS/Phase2/2c-TechnicalCleanup/Spec.md\n","status":"closed","priority":2,"issue_type":"chore","created_at":"2026-01-08T10:07:43.927331Z","created_by":"cburr","updated_at":"2026-01-09T12:18:08.315907Z","closed_at":"2026-01-09T12:18:08.315907Z","close_reason":"Migration created to drop 39 legacy Django tables. Verified locally: 70→32 tables, all queries work correctly.","dependencies":[{"issue_id":"AssurancePlatform-jdr","depends_on_id":"AssurancePlatform-dpk","type":"parent-child","created_at":"2026-01-09T09:38:33.776548Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-mcd","title":"Permission and auth flow integration tests","description":"Write integration tests for permission and authentication logic.\n\n## Flows to Test\n- Case sharing (owner grants access)\n- Team membership (join, leave)\n- Permission levels (view, edit, manage)\n- Invite acceptance/rejection\n\n## Security Tests\n- Unauthorised access attempts\n- Permission escalation attempts\n- Cross-user data access","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-15T12:33:38.194561Z","created_by":"cburr","updated_at":"2026-01-15T12:33:38.194561Z","dependencies":[{"issue_id":"AssurancePlatform-mcd","depends_on_id":"AssurancePlatform-67b","type":"blocks","created_at":"2026-01-15T12:33:46.069326Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-na6","title":"Reset password functionality","description":"Users need the ability to reset their password via email link.\n\nGitHub Issue: #642\n\nRequirements:\n- Set up SMTP and TURING 'from' email address (requires IT support)\n- 'Forgot password' link on login page\n- Email sent with password reset link\n- Token valid for 30-60 minutes\n\nStatus: BLOCKED - waiting on IT for SMTP configuration details.\n\nAcceptance Criteria:\n- [ ] SMTP configured with Turing email address\n- [ ] Forgot password link on login page\n- [ ] Password reset email sent successfully\n- [ ] Token expires after 30-60 minutes\n- [ ] User can set new password via reset link","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-07T13:43:26.52922Z","created_by":"cburr","updated_at":"2026-01-07T15:09:43.953045Z","closed_at":"2026-01-07T15:09:43.953045Z","close_reason":"Fixed via PR #736 - added missing Prisma migration for password_reset_attempts and security_audit_logs tables. Verified working in staging.","labels":["auth"]}
{"id":"AssurancePlatform-npj","title":"Add E2E tests to CI pipeline","description":"Add Playwright E2E tests to CI pipeline.\n\n## Changes\nAdd new job or step:\n\n```yaml\n- name: Install Playwright browsers\n  run: pnpm exec playwright install --with-deps chromium\n\n- name: Run E2E tests\n  run: pnpm exec playwright test\n  env:\n    BASE_URL: http://localhost:3000\n```\n\n## Considerations\n- May need to start the app first (pnpm build \u0026\u0026 pnpm start)\n- Consider running E2E only on main/staging, not every PR\n- Upload test artifacts (screenshots, traces) on failure","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-15T12:35:07.943346Z","created_by":"cburr","updated_at":"2026-01-15T12:35:07.943346Z","dependencies":[{"issue_id":"AssurancePlatform-npj","depends_on_id":"AssurancePlatform-qw4","type":"blocks","created_at":"2026-01-15T12:35:13.937143Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-o5o","title":"Write auth flow E2E tests","description":"Write E2E tests for authentication flows.\n\n## Tests\n- Sign in with credentials\n- Sign in with GitHub OAuth\n- Sign in with Google OAuth\n- Sign out\n- Password reset flow\n- Account creation\n\n## Assertions\n- Redirect to dashboard after login\n- Session persists across pages\n- Protected routes redirect to login","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-15T12:34:24.289181Z","created_by":"cburr","updated_at":"2026-01-15T12:34:24.289181Z","dependencies":[{"issue_id":"AssurancePlatform-o5o","depends_on_id":"AssurancePlatform-8sk","type":"blocks","created_at":"2026-01-15T12:34:34.789192Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-ogq","title":"Consider removing legacy_mappings table","description":"Decision deadline: May 2026. The legacy_mappings table (3,767 rows) stores old Django ID to new Prisma UUID mappings from the Dec 2025 migration. If no lookup requests by May 2026, remove via Prisma migration.","status":"blocked","priority":4,"issue_type":"task","created_at":"2026-01-09T14:24:56.924233Z","created_by":"cburr","updated_at":"2026-01-09T14:25:46.546274Z","labels":["tech-debt"]}
{"id":"AssurancePlatform-op3","title":"Restore detailed case study content lost in Docusaurus to Nextra migration","description":"During the migration from Docusaurus to Nextra, the detailed case study content was replaced with placeholder versions. The original detailed content exists in git history at commit 37fd3173862678368f6f4383d12f815eb7d0f0e3.\n\n**Current state (placeholders in `content/curriculum/hands-on/case-studies/`):**\n- ~70 lines each\n- Basic structure: Background, The System, Assurance Goals, Key Considerations, Discussion Questions\n\n**Original detailed content (in git history):**\n- ~200-300 lines each\n- Comprehensive structure including:\n  - Hero image with metadata table\n  - Detailed system description with 'How It Works' steps\n  - Key Technical Details table (model architecture, training data, etc.)\n  - Deployment Context\n  - Stakeholder table with interests and concerns\n  - Regulatory Context section\n  - Goal-specific considerations (Fairness/Explainability)\n  - Deliberative Prompts\n  - Suggested Strategies\n  - Recommended Techniques linking to TEA Techniques library\n\n**Files to restore:**\n1. `diabetic-retinopathy-screening.md` → Explainable Diabetic Retinopathy Screening System\n2. `crop-damage-assessment.md` → Fair Crop Damage Assessment System  \n3. `flood-risk-assessment.md` → Equitable Flood Risk Assessment System\n4. `student-learning-assessment.md` → Explainable Student Learning Assessment System\n\n**Git command to retrieve original content:**\n```bash\ngit show 37fd3173862678368f6f4383d12f815eb7d0f0e3:tea-docs/docs/docs/curriculum/case-studies/\u003cfilename\u003e.md\n```\n\n**Note:** The content will need to be converted from Docusaurus MD format to Nextra MDX format, and image paths may need updating.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-08T08:32:05.851178Z","created_by":"cburr","updated_at":"2026-01-08T15:05:38.321726Z","closed_at":"2026-01-08T15:05:38.321726Z","close_reason":"All four case studies restored with detailed content in commit 5356393. Files now have 155-214 lines each with full structure: hero images, technical details tables, stakeholder tables, regulatory context, deliberative prompts, and links to TEA techniques."}
{"id":"AssurancePlatform-p11","title":"Add test execution to GitHub Actions workflow","description":"Add test execution step to .github/workflows/build.yaml.\n\n## Changes\nAdd after lint/typecheck step:\n\n```yaml\n- name: Run tests\n  run: pnpm run test:coverage:check\n  env:\n    DATABASE_URL: postgresql://tea_test:tea_test@localhost:5432/tea_test\n```\n\n## Considerations\n- Tests should fail the build if they don't pass\n- Coverage report should be uploaded as artifact\n- Consider caching test dependencies","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-15T12:35:04.136612Z","created_by":"cburr","updated_at":"2026-01-15T12:35:04.136612Z","dependencies":[{"issue_id":"AssurancePlatform-p11","depends_on_id":"AssurancePlatform-qw4","type":"blocks","created_at":"2026-01-15T12:35:13.624367Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-qw4","title":"5e: CI Integration","description":"Parent task for integrating tests into CI/CD pipeline.\n\n## Tasks\n1. Add test execution to GitHub Actions workflow\n2. Configure test database for CI\n3. Add E2E tests to CI pipeline\n\n## Current State\n- Tests NOT run in CI (only lint + typecheck)\n- No test database in CI\n- No E2E in CI\n\n## Acceptance Criteria\n- [ ] Unit/integration tests run on every PR\n- [ ] Test database spins up in CI\n- [ ] E2E tests run on PRs\n- [ ] Test failures block merge","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-15T12:34:48.086709Z","created_by":"cburr","updated_at":"2026-01-15T12:34:48.086709Z","labels":["devops","testing"],"dependencies":[{"issue_id":"AssurancePlatform-qw4","depends_on_id":"AssurancePlatform-g2a","type":"blocks","created_at":"2026-01-15T12:35:01.970342Z","created_by":"cburr"},{"issue_id":"AssurancePlatform-qw4","depends_on_id":"AssurancePlatform-67b","type":"blocks","created_at":"2026-01-15T12:35:02.13713Z","created_by":"cburr"},{"issue_id":"AssurancePlatform-qw4","depends_on_id":"AssurancePlatform-8sk","type":"blocks","created_at":"2026-01-15T12:35:02.283244Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-qxo","title":"Security: Add rate limiting to critical endpoints","description":"Several security-critical endpoints lack rate limiting:\n\n**Affected endpoints:**\n- /api/users/register - Account creation (spam/bot registrations)\n- /api/invites/[token]/accept - Invite acceptance (brute-force token guessing)\n\nNote: Password reset DOES have rate limiting in the service layer.\n\n**Impact:**\n- User enumeration attacks\n- Brute-force invite token guessing\n- Denial of service through resource exhaustion\n- Bot/spam registrations\n\n**Fix:** Implement rate limiting at the API route level using Next.js middleware. Consider IP-based and user-based limits.\n\n**Confidence:** 85%","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-24T10:27:27.006088Z","updated_at":"2026-01-07T16:46:35.056103Z","closed_at":"2026-01-07T16:46:35.056103Z","close_reason":"Implemented rate limiting for /api/users/register (5 IP/hr, 3 email/hr) and /api/invites/[token]/accept (20 IP/hr, 10 user/hr). Added RateLimitAttempt model, rate-limit-service.ts, and comprehensive tests.","labels":["rate-limiting","security"]}
{"id":"AssurancePlatform-qzl","title":"Type System Modernisation: Remove v1 compatibility types","description":"Clean up legacy v1 (Django) type definitions when v1 import support is no longer needed.\n\n## Background\n\nThe types in `types/domain.ts` and `types/index.d.ts` maintain Django-era field naming for import/export compatibility:\n- `Group` type (replaced by `Team` in Prisma schema)\n- `edit_groups`, `view_groups`, `review_groups` on AssuranceCase\n- `short_description`, `long_description` (consolidated to single `description` in Prisma)\n- `goal_id`, `strategy_id`, `property_claim_id` (replaced by `parentId` in unified AssuranceElement)\n\nThese are used by `lib/transforms/v1-to-v2.ts` for importing legacy case exports.\n\n## Files to update\n\n- `types/domain.ts` - Remove legacy types or mark as deprecated\n- `types/index.d.ts` - Remove duplicate legacy types\n- `lib/transforms/v1-to-v2.ts` - Keep for backwards compatibility or deprecate\n- `lib/schemas/case-export.ts` - Update export schema if v1 format no longer needed\n\n## Decision required\n\nBefore proceeding, determine:\n1. Is v1 (Django) import still needed for any users?\n2. Can we deprecate v1 import with a migration path?\n3. Should we keep read-only v1 import but remove export support?\n\n## Reference\n\nOriginally identified during doc comment review in issue at5.\nSee `TASKS/Phase2-DescriptionFieldConsolidation.md` (referenced but not yet created).","status":"blocked","priority":4,"issue_type":"task","created_at":"2026-01-09T15:07:07.632648Z","created_by":"cburr","updated_at":"2026-01-09T15:07:26.699369Z"}
{"id":"AssurancePlatform-sbb","title":"Investigate Nextra 5 alpha for docs compilation performance","description":"Nextra 4.6.1 has severe dev compilation issues (69+ seconds for /docs route). GitHub issue #3675 was supposedly fixed in 4.0.0-app-router.24 but the fix doesn't appear to be in stable releases.\n\nNextra 5 alpha (5.0.0-alpha.24) may have architectural improvements that address this. Need to:\n1. Check Nextra 5 alpha changelog for performance fixes\n2. Test compilation time with Nextra 5 alpha\n3. Assess migration effort and breaking changes\n4. Determine if stable enough for use\n\nRelated: AssurancePlatform-2lo (blocked P1 bug)","status":"blocked","priority":2,"issue_type":"task","created_at":"2026-01-13T14:45:33.549048Z","created_by":"cburr","updated_at":"2026-01-13T14:49:31.194554Z","comments":[{"id":5,"issue_id":"AssurancePlatform-sbb","author":"cburr","text":"Research findings (2026-01-13):\n\nNextra 5.0.0-alpha.24 analysis:\n- Only change is adding onSearch callback to Search component\n- NO performance improvements, compilation fixes, or git timestamp changes found\n- The 5.x alpha appears to be early stage without the fixes we need\n\nAlternative workarounds identified:\n1. Use 'pnpm build \u0026\u0026 pnpm start' instead of dev mode - compiles once, then serves\n2. Accept slow initial compile, subsequent hot reloads may be faster (untested)\n3. Exclude /docs from regular dev workflow, only test when needed\n\nRecommendation: Nextra 5 alpha is NOT a solution currently. Consider:\n- Monitoring Nextra releases for performance fixes\n- Using build+start for docs testing\n- Investigating if the catch-all route can be restructured","created_at":"2026-01-13T14:49:01Z"}]}
{"id":"AssurancePlatform-swc","title":"Security: Validate session keys against database revocation","description":"The isValidSession function in lib/auth-helpers.ts (lines 7-30) only performs client-side validation and doesn't check if the refresh token has been revoked in the database.\n\n**Issue:** This function checks for session key expiry but doesn't validate that the key is actually valid in the database (via the revokedAt field in RefreshToken table).\n\n**Attack Scenario:**\n1. User logs in, gets session with refresh token\n2. Admin revokes all user's tokens (security incident)\n3. User's JWT still contains the key and hasn't expired\n4. isValidSession returns true, allowing continued access\n\n**Fix:** Ensure all security-critical code paths use validateRefreshToken() from the refresh-token-service which does proper database validation, or add a note clarifying this is for quick UI checks only.\n\n**Confidence:** 82%","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-24T10:27:32.943297Z","updated_at":"2026-01-09T09:37:09.805923Z","closed_at":"2026-01-09T09:37:09.805923Z","close_reason":"Security concern becomes irrelevant once RefreshToken is removed in 5fm (JWT-only auth)","labels":["auth","security"],"dependencies":[{"issue_id":"AssurancePlatform-swc","depends_on_id":"AssurancePlatform-dpk","type":"parent-child","created_at":"2026-01-09T09:39:04.654305Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-tk1","title":"Phase 2b: Documentation Migration (Docusaurus to Nextra)","description":"Migrate documentation from Docusaurus to Nextra for better Next.js integration.\n\nTasks:\n- [x] Evaluate Nextra configuration options\n- [x] Create Nextra project structure\n- [x] Migrate MDX content files\n- [x] Adapt custom React components\n- [x] Configure navigation ordering (_meta.ts files)\n- [x] Process pageMap for hidden items\n- [ ] Configure search (Flexsearch) - DEFERRED\n- [x] Set up CI/CD for docs deployment\n- [x] Update documentation URLs/redirects (/documentation → /docs)\n\nStructure:\n- content/ directory with MDX files\n- components/docs/ for documentation-specific components\n- Nextra 4.x (App Router compatible)\n\nDeferred:\n- Search functionality (Flexsearch)\n- Versioning","status":"tombstone","priority":0,"issue_type":"task","created_at":"2026-01-07T12:58:03.913543Z","created_by":"cburr","updated_at":"2026-01-07T13:00:15.696017Z","labels":["documentation"],"deleted_at":"2026-01-07T13:00:15.696017Z","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"AssurancePlatform-ujm","title":"5a: Test Infrastructure Cleanup","description":"Parent task for cleaning up the existing test infrastructure.\n\n## Tasks\n1. Delete deprecated Prisma mock files\n2. Delete test files that heavily mock Prisma (~100 files)\n3. Update testing skill to be user-invocable\n4. Update TASKS/Phase5 spec files to reflect new philosophy\n\n## What to Keep\n- vitest.config.ts\n- vitest.config.performance.ts\n- src/__tests__/setup.tsx\n- src/__tests__/mocks/server.ts (MSW)\n- src/__tests__/mocks/handlers.ts\n- src/__tests__/utils/*.ts (utilities)\n\n## What to Discard\n- lib/__mocks__/prisma-new.ts\n- Most *.test.ts files that mock Prisma\n- ~15 .todo() stub files\n\n## Acceptance Criteria\n- [ ] pnpm test runs without errors\n- [ ] No Prisma mock files remain\n- [ ] Testing skill updated\n- [ ] Spec files updated","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-15T12:24:48.09448Z","created_by":"cburr","updated_at":"2026-01-15T12:24:48.09448Z","labels":["testing"],"dependencies":[{"issue_id":"AssurancePlatform-ujm","depends_on_id":"AssurancePlatform-g2a","type":"blocks","created_at":"2026-01-15T12:24:49.022993Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-uvd","title":"Phase 2a: DevOps \u0026 CI/CD","description":"Address CI/CD pipeline issues and improve deployment reliability.\n\nTasks:\n- [x] Audit current CI/CD pipeline configuration\n- [x] Implement health check endpoint (/api/health)\n- [x] Add pre-build validation (lint + type-check)\n- [x] Add deployment error handling with retry\n- [x] Add deployment notifications (GitHub summaries)\n- [x] Configure Azure health probe\n\nFiles changed:\n- app/api/health/route.ts (created)\n- .github/workflows/build.yaml (modified)\n- biome.json (modified)\n\nAcceptance Criteria:\n- /api/health returns 200 when DB connected, 503 when not\n- Lint/type-check failures block builds\n- Webhook retries on failure\n- Deployments complete without manual intervention","status":"tombstone","priority":0,"issue_type":"task","created_at":"2026-01-07T12:58:03.593812Z","created_by":"cburr","updated_at":"2026-01-07T13:00:12.657522Z","labels":["devops"],"deleted_at":"2026-01-07T13:00:12.657522Z","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
{"id":"AssurancePlatform-vg4","title":"API route integration tests (with real DB)","description":"Write integration tests for API routes using real database.\n\n## Routes to Test\n- /api/cases (CRUD)\n- /api/teams (CRUD)\n- /api/published-assurance-cases\n- /api/case-studies\n\n## Pattern\n- Seed data in transaction\n- Call route handler directly\n- Assert response shape and status","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-15T12:33:37.103871Z","created_by":"cburr","updated_at":"2026-01-15T12:33:37.103871Z","dependencies":[{"issue_id":"AssurancePlatform-vg4","depends_on_id":"AssurancePlatform-67b","type":"blocks","created_at":"2026-01-15T12:33:45.912774Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-w8s","title":"Server Actions integration tests (with real DB)","description":"Write integration tests for Server Actions using real database.\n\n## Actions to Test\n- actions/assurance-cases.ts (create, update, delete)\n- actions/users.ts (profile updates)\n- actions/teams.ts (team operations)\n\n## Pattern\n```typescript\nit(\"creates a case for authenticated user\", async () =\u003e {\n  await withTestTransaction(async (tx) =\u003e {\n    const user = await seedTestUser(tx)\n    const result = await createCase(user.token, { name: \"Test Case\" })\n    expect(result.data).toBeDefined()\n    expect(result.data.name).toBe(\"Test Case\")\n  })\n})\n```","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-15T12:33:36.083073Z","created_by":"cburr","updated_at":"2026-01-15T12:33:36.083073Z","dependencies":[{"issue_id":"AssurancePlatform-w8s","depends_on_id":"AssurancePlatform-67b","type":"blocks","created_at":"2026-01-15T12:33:45.656348Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-wk0","title":"Security: Enable email verification for invite acceptance","description":"The acceptInvite function in lib/services/case-permission-service.ts (lines 706-710) has email verification commented out, allowing any authenticated user to accept invites meant for specific email addresses.\n\n**Attack Scenario:**\n1. Admin invites alice@company.com with ADMIN permissions\n2. Attacker bob@attacker.com creates account and logs in\n3. Bob intercepts/discovers the invite token\n4. Bob accepts the invite and gains ADMIN access to the case\n\n**Impact:** Authorization bypass allowing privilege escalation.\n\n**Fix:** Enable the email verification check that is already implemented but commented out.\n\n**Confidence:** 90%","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-24T10:27:11.529298Z","updated_at":"2026-01-07T16:00:20.645569Z","closed_at":"2026-01-07T16:00:20.645569Z","close_reason":"Fixed: enabled email verification, added transaction for race condition protection, explicit null checks, and security audit logging","labels":["auth","security"]}
{"id":"AssurancePlatform-x8n","title":"5b: Real Database Testing Setup","description":"Parent task for setting up real database testing infrastructure.\n\n## Tasks\n1. Create test database Docker Compose config\n2. Implement transaction rollback test helpers\n3. Create database seeding utilities\n4. Write first integration test using real DB (proof of concept)\n\n## Architecture\n- Docker Compose service for test Postgres\n- Same version as production\n- Transaction rollback pattern for test isolation\n- Seed data from existing mock-data.ts\n\n## Acceptance Criteria\n- [ ] docker-compose.testing.yml includes test database\n- [ ] db-test-utils.ts provides transaction helpers\n- [ ] Seed utilities populate test data\n- [ ] POC test passes against real DB","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-15T12:32:37.280513Z","created_by":"cburr","updated_at":"2026-01-15T12:32:37.280513Z","labels":["testing"],"dependencies":[{"issue_id":"AssurancePlatform-x8n","depends_on_id":"AssurancePlatform-g2a","type":"blocks","created_at":"2026-01-15T12:32:56.571377Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-xcc","title":"Write import/export E2E tests","description":"Write E2E tests for import/export flows.\n\n## Tests\n- Export case as JSON\n- Export case as SVG\n- Export case as PNG\n- Import case from GitHub (mock)\n- Backup to Google Drive (mock)\n\n## Note\nExternal service calls (GitHub, Google Drive) should be mocked at the network level.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-15T12:34:28.723369Z","created_by":"cburr","updated_at":"2026-01-15T12:34:28.723369Z","dependencies":[{"issue_id":"AssurancePlatform-xcc","depends_on_id":"AssurancePlatform-8sk","type":"blocks","created_at":"2026-01-15T12:34:35.230668Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-y3e","title":"Delete test files that heavily mock Prisma","description":"Delete test files that heavily mock Prisma (~100 files). These tests provide false confidence.\n\n## Criteria for Deletion\n- Tests that mock prisma.*.findUnique, create, update, delete, etc.\n- Tests where \u003e50% of setup is mock configuration\n- Tests that assert on mock call arguments rather than behaviour\n\n## Exceptions (Keep)\n- Tests that use MSW for external API mocking\n- Pure unit tests with no database interaction\n- Integration tests that could be adapted to use real DB","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-15T12:32:12.020211Z","created_by":"cburr","updated_at":"2026-01-15T12:32:12.020211Z","dependencies":[{"issue_id":"AssurancePlatform-y3e","depends_on_id":"AssurancePlatform-ujm","type":"blocks","created_at":"2026-01-15T12:32:23.422395Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-y6n","title":"Write first integration test using real DB (POC)","description":"Write a proof-of-concept integration test using the real database.\n\n## Goal\nProve the transaction rollback pattern works correctly.\n\n## Test Case\nTest case creation service:\n1. Seed a test user\n2. Call createCase service\n3. Assert case was created with correct owner\n4. Transaction rolls back (no cleanup needed)\n\n## Success Criteria\n- Test passes\n- No data persists after test\n- Test runs in \u003c 500ms","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-15T12:33:02.295352Z","created_by":"cburr","updated_at":"2026-01-15T12:33:02.295352Z","dependencies":[{"issue_id":"AssurancePlatform-y6n","depends_on_id":"AssurancePlatform-x8n","type":"blocks","created_at":"2026-01-15T12:33:07.700198Z","created_by":"cburr"}]}
{"id":"AssurancePlatform-yiy","title":"Add search functionality to documentation (Flexsearch)","description":"The Nextra documentation site currently has no search functionality.\n\nImplement Flexsearch for documentation search as deferred from Phase 2b.\n\nLocation: content/ and components/docs/","status":"tombstone","priority":3,"issue_type":"task","created_at":"2026-01-07T13:00:45.986902Z","created_by":"cburr","updated_at":"2026-01-07T13:02:12.953997Z","labels":["documentation"],"deleted_at":"2026-01-07T13:02:12.953997Z","deleted_by":"daemon","delete_reason":"delete","original_type":"task"}
